(function(e,n,r){n.namespace=function(e,g){if(e){e=String(e);var f=e.split("."),m=f.length,c=n,k;for(k=0;k<m;k+=1)c[f[k]]||(c[f[k]]={},k===m-1&&g&&(c[f[k]]=g)),c=c[f[k]];return c}return!1};e.app=n})(window,window.app||{});(function(e,n,r,l){var g=function(){var f=null,m=e.console!==l&&e.console.log,c=e.console!==l&&console.time!==l&&console.timeEnd!==l,k=[];return{logToScreen:function(a){var b=n.getElementById("log"),d=n.createElement("p");a=n.createTextNode(a);b&&(d.appendChild(a),b.appendChild(d))},log:function(a){m&&e.console.log(a);g.logToScreen(a)},logTimerStart:function(a){c&&e.console.time(a)},logTimerEnd:function(a){c&&e.console.timeEnd(a)},on:function(a,b,d){g.on="function"===typeof e.addEventListener?function(p,
q,a){p.addEventListener(q,a,!1)}:"function"===typeof n.attachEvent?function(p,q,a){p.attachEvent("on"+q,a)}:function(a,q,b){a["on"+q]=b};g.on(a,b,d)},off:function(a,b,d){g.off="function"===typeof e.removeEventListener?function(a,q,b){a.removeEventListener(q,b,!1)}:"function"===typeof n.detachEvent?function(a,q,b){a.detachEvent("on"+q,b)}:function(a,q){a["on"+q]=null};g.off(a,b,d)},createDomNode:function(a,b){var d=n.createElement(a),p;if(b)for(p in b)b.hasOwnProperty(p)&&d.setAttribute(p,b[p]);return d},
getXhr:function(){for(var a=null,b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],d=b.length,p=0,p=0;p<d;p+=1){try{a=b[p]()}catch(q){continue}break}return a},xhr:function(a,b,d,p){var q=g.getXhr(),t,c="GET";q?(p!==l?c="POST":p=null,d===l&&(d=!0),t=function(){if(4===q.readyState&&(200<=q.status&&400>q.status||0===q.status))try{var a=q.responseText;
a?b(a):b(!1)}catch(p){b(!1)}},q.open(c,a,d),q.onreadystatechange!==l?q.onreadystatechange=t:q.onload!==l&&(q.onload=t),q.send(p)):b(!1)},getJson:function(){null===f&&(e.JSON&&e.JSON.stringify)&&(f=e.JSON);return f},jsonToString:function(a){var b=!1;null===f&&(f=g.getJson());f&&a&&(b=f.stringify(a));return b},jsonToObject:function(a){var b=!1;null===f&&(f=g.getJson());f&&a&&(b=f.parse(a));return b},url:function(a){if(a){var b=n.createElement("a"),d;b.href=a;d=b.pathname.match(/\/([^\/?#]+)$/i);var p=
b.protocol,q=b.hostname,t=b.port,c=b.search;d=d?d[1]:"/";var e=b.hash,b=b.pathname.replace(/^([^\/])/,"/$1"),h=a.lastIndexOf("/"),h=a.substr(0,h+1);return{source:a,protocol:p,host:q,port:t,query:c,file:d,hash:e,path:b,folder:h}}},callback:function(a){a&&"function"===typeof a||(a=function(){});return a},isArray:function(a){return a instanceof Array},inArray:function(a,b,d){return Array.prototype.indexOf?k.indexOf.call(b,a,d):-1},hasClass:function(a,b){return RegExp(" "+b+" ").test(" "+a.className+
" ")},getAttribute:function(a,b){return a.getAttribute(b)},removeAttribute:function(a,b){return a.removeAttribute(b)}}}();r.namespace("helpers.utils",g)})(window,document,window.app||{});(function(e,n){function r(){this.methods=[];this.response=null;this.flushed=!1}r.prototype=r.fn={add:function(e){this.flushed?e(this.response):this.methods.push(e)},flush:function(e){if(!this.flushed)for(this.response=e,this.flushed=!0;this.methods[0];)this.methods.shift()(e)}};e.namespace("helpers.queue",r)})(window.app||{});(function(e,n,r){function l(g,f){f&&(f.dom?g=f.dom:f.id&&(g=e.getElementById(f.id)));return g}r=function(){var g=n.helpers,f=g.utils,m=f.createDomNode,c=g.client,k=[],a=[],b=[],d=[],p=e.getElementsByTagName("head")[0];return{appendCss:function(a,b,d,w){if(-1===f.inArray(a,k)){var h,g;h=l(null,w);if(null!==b){h||(h=m("style",{type:"text/css"}));w||p.appendChild(h);try{g=e.createTextNode(b),h.appendChild(g)}catch(u){h.styleSheet.cssText=b}finally{d()}}else null!==a&&(h||(h=m("link",{rel:"stylesheet",
type:"text/css"})),w||p.appendChild(h),c.isMsie||c.isOpera?h.onload=d:d(),h.href=a);k.push(a)}else d()},appendJs:function(b,d,c,k){if(-1===f.inArray(b,a)){var h=m("script"),g=e.getElementsByTagName("script")[0],u=!1,h=l(h,k);h.type="text/javascript";h.async=!0;h.onreadystatechange=h.onload=function(){u||this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||(this.onreadystatechange=this.onload=null,u=!0,a.push(b),c())};h.onerror&&(h.onerror=function(){this.onload=this.onreadystatechange=
this.onerror=null;c()});k||(g?g.parentNode.insertBefore(h,g):p.appendChild(h));d&&!u?(h.textContent?h.textContent=d:h.nodeValue?h.nodeValue=d:h.text=d,u=!0):null!==b&&(h.src=b);u&&(a.push(b),c())}else c()},appendImg:function(a,d,p,c){(c=l(null,c))||(c=new Image);c.onload=p;d?c.src=d:a&&(c.src=a);b.push(a)},appendHtml:function(a,b,p,c){var h;if(h=l(null,c)){if(b)try{h.innerHTML=b,c.id&&e.styleSheets[0].addRule("#"+c.id+":after","content: ' ';")}catch(f){h.innerText=b}p();d.push(a)}else p()}}}();n.namespace("helpers.append",
r)})(document,window.app||{});(function(e,n,r){function l(b){var d="";switch(b.code){case FileError.QUOTA_EXCEEDED_ERR:d="["+c+" Adapter] File System Event: QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:d="["+c+" Adapter] File System Event: NOT_FOUND_ERR, file does not exist";break;case FileError.SECURITY_ERR:d="["+c+" Adapter] File System Event: SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:d="["+c+" Adapter] File System Event: INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:d="["+c+" Adapter] File System Event: INVALID_STATE_ERR";
break;default:d="["+c+" Adapter] File System Event: Unknown Error"}a(d)}function g(a,b,d){if("."===b[0]||""===b[0])b=b.slice(1);b[0]?a.getDirectory(b[0],{create:!0},function(a){b.length?g(a,b.slice(1),d):d()},l):d()}function f(a,d,c){d=d.split("/");var e=d.length,f="",h=0;c=b(c);if(e){for(h=0;h<e-1;h+=1)f=f+d[h]+"/";g(a.root,f.split("/"),c)}else c()}function m(a){this.adapter=null;this.type=c;this.size=52428800;this.init(a)}var c="fileSystem",k=n.helpers.utils,a=k.log,b=k.callback,d=null;m.prototype=
m.fn={isSupported:function(){null===d&&((d=(!!e.requestFileSystem||!!e.webkitRequestFileSystem)&&!!e.Blob)||a("["+c+" Adapter] "+c+" is not supported"));return d},open:function(b){var d=this,f=d.adapter;null===f?(e.requestFileSystem=e.requestFileSystem||e.webkitRequestFileSystem,e.requestFileSystem(e.TEMPORARY,d.size,function(e){f=d.adapter=e;a("["+c+" Adapter] Try to create test resource");try{d.create("test-item",k.jsonToString({test:"test-content"}),function(h){h?d.remove("test-item",function(){a("["+
c+" Adapter] Test resource created and successfully deleted");b(f)}):b(!1)})}catch(g){l(g),b(!1)}},l)):b(f)},create:function(a,b,d){var c=this.adapter,e=function(a){l(a);d(!1,a)};f(c,a,function(){c.root.getFile(a,{create:!0},function(a){a.createWriter(function(a){a.onwriteend=function(){d(!0)};a.onerror=e;try{var p=new Blob([b],{type:"text/plain"});a.write(p)}catch(h){e(h)}},e)},e)})},read:function(a,b){var d=this.adapter,c=function(a){l(a);b(!1,a)};f(d,a,function(){d.root.getFile(a,{create:!1},function(a){a.file(function(a){var d=
new FileReader;d.onloadend=function(){b(this.result)};d.readAsText(a)},c)},c)})},update:function(a,b,d){this.create(a,b,d)},remove:function(a,b){var d=this.adapter,c=function(d){l(d);b(a,d)};f(d,a,function(){d.root.getFile(a,{create:!1},function(a){a.remove(function(){b()},c)},c)})},init:function(a){return this.isSupported()?(a&&a.size&&(this.size=a.size),this):!1}};n.namespace("cache.storage.adapter."+c,m)})(window,window.app||{});(function(e,n,r){function l(c){this.adapter=null;this.type=g;this.dbName="merkel";this.dbVersion="1.0";this.dbTable="offline";this.dbDescription="Local cache";this.dbKey="key";this.init(c)}var g="indexedDatabase",f=n.helpers.utils.log,m=null;l.prototype=l.fn={isSupported:function(){null===m&&((m=!!e.indexedDB||!!e.webkitIndexedDB||!!e.mozIndexedDB||!!e.OIndexedDB||!!e.msIndexedDB)||f("["+g+" Adapter] "+g+" is not supported"));return m},create:function(c,e,a){var b=this.dbTable,d=this.dbName,p=this.adapter.transaction([b],
"readwrite");c=p.objectStore(b).put({key:c,content:e});p.onerror=function(b){f("["+g+" Adapter] Failed to init transaction while creating/updating database entry "+d+" "+b);a(!1,b)};c.onerror=function(b){f("["+g+" Adapter] Failed to create/update database entry "+d+" "+b);a(!1,b)};c.onsuccess=function(){a(!0)}},read:function(c,e){var a=this.dbTable,b=this.dbName,d=this.adapter.transaction([a],"readonly"),a=d.objectStore(a).get(c);d&&a?(d.onerror=function(a){f("["+g+" Adapter] Failed to init transaction while reading database "+
b+" "+a)},a.onerror=function(a){f("["+g+" Adapter] Failed to read database entry "+b+" "+a);e(!1,a)},a.onsuccess=function(a){a.target.result&&a.target.result.content?e(a.target.result.content):e(!1)}):e(!1)},update:function(c,e,a){this.create(c,e,a)},remove:function(c,e){var a=this.dbTable,b=this.dbName,d=this.adapter.transaction([a],"readwrite"),a=d.objectStore(a)(a).put({key:c,content:""});d.onerror=function(a){f("["+g+" Adapter] Failed to init transaction while deleting database entry "+b+" "+
a);e(!1,a)};a.onerror=function(a){f("["+g+" Adapter] Failed to delete database entry "+b+" "+a);e(!1,a)};a.onsuccess=function(){e(!0)}},open:function(c,k){var a=this,b=null,d=null,p=null,q=a.dbName,t=a.dbTable,l,m,h,n;k||(k=!1);if(null===a.adapter)if(b=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.OIndexedDB||e.msIndexedDB){e.webkitIndexedDB!==r&&(e.IDBTransaction=e.webkitIDBTransaction,e.IDBKeyRange=e.webkitIDBKeyRange);l=function(b){var h=d.result;a.adapter=h;a.dbVersion===h.version||!h.setVersion&&
"function"!==typeof h.setVersion?c(h):(p=b.currentTarget.result.setVersion(a.dbVersion),p.onfailure=function(a){f("["+g+" Adapter] Failed to open database: "+q+" "+a);c(!1)},p.onsuccess=function(b){var h=d.result.createObjectStore(t,{keyPath:a.dbKey});f("["+g+" Adapter] Database needs upgrade: "+q+" "+b.oldVersion+" "+b.newVersion);h.createIndex("key","key",{unique:!0});h.createIndex("content","content",{unique:!1})})};m=function(b){var h=d.result.createObjectStore(t,{keyPath:a.dbKey});f("["+g+" Adapter] Database needs upgrade: "+
q+" "+b.oldVersion+" "+b.newVersion);h.createIndex("key","key",{unique:!0});h.createIndex("content","content",{unique:!1})};h=function(b){f("["+g+" Adapter] Failed to open database: "+q+" "+b);k||a.open(c,!0);c(!1)};n=function(a){f("["+g+" Adapter] Opening database request is blocked! "+q+" "+a);c(!1)};if(k)try{d=b.open(q,a.dbVersion)}catch(u){f(u),d=b.open(q)}else d=b.open(q);d.onsuccess=l;d.onupgradeneeded=m;d.onerror=h;d.onblocked=n}else c(!1);else c(a.adapter)},init:function(c){return this.isSupported()?
(c&&(c.name&&(this.dbName=c.name),c.version&&(this.dbVersion=c.version),c.table&&(this.dbTable=c.table),c.description&&(this.dbDescription=c.description),c.key&&(this.dbKey=c.key)),this):!1}};n.namespace("cache.storage.adapter."+g,l)})(window,window.app||{});(function(e,n,r){function l(a,b,d,c,e,f){!f&&a?a.transaction(function(a){a.executeSql(b,d,c,e)}):f?f.executeSql(b,d,c,e):e(null,{code:0,message:"The storage adapter isn't available"})}function g(a){var b="["+m+" Adapter] Errorcode: "+a.code+", Message: "+a.message;a.info&&(b=b+" - "+a.info);c(b)}function f(a){this.adapter=null;this.type=m;this.dbName="merkel";this.dbVersion="1.0";this.dbDescription="resource cache";this.dbTable="cache";this.dbSize=4194304;this.init(a)}var m="webSqlDatabase",c=n.helpers.utils.log,
k=null;f.prototype=f.fn={isSupported:function(){null===k&&((k=!!e.openDatabase)||c("["+m+" Adapter] "+m+" is not supported"));return k},create:function(a,b,d){l(this.adapter,"INSERT INTO "+this.dbTable+" (key, content) VALUES (?,?);",[a,b],function(){d(!0)},function(a,b){g(b);d(!1,b,{transaction:a})})},read:function(a,b){l(this.adapter,"SELECT content FROM "+this.dbTable+" WHERE key=?;",[a],function(a,c){var e=null;c&&(c.rows&&1===c.rows.length)&&(e=c.rows.item(0).content);b(e,null,{transaction:a})},
function(a,c){g(c);b(!1,c,{transaction:a})})},update:function(a,b,d){l(this.adapter,"UPDATE "+this.dbTable+" SET content = ?  WHERE key=?;",[b,a],function(){d(!0)},function(a,b){g(b);d(!1,b,{transaction:a})})},remove:function(a,b){l(this.adapter,"DELETE FROM "+this.dbTable+" WHERE key = ?;",[a],function(){b(!0)},function(a,c){g(c);b(!1,c,{transaction:a})})},open:function(a){var b=this,d=b.adapter,c=function(d,c){l(d,"CREATE TABLE IF NOT EXISTS "+b.dbTable+"(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, key TEXT NOT NULL UNIQUE, content TEXT NOT NULL);",
[],function(){a(d)},function(b){g(b);a(!1)},c)},f=function(a){c(null,a)},k=function(b){b.info="Can't migrate to new database version and using localStorage instead. This may be caused by non-standard implementation of the changeVersion method. Please switch back your database version to use webSql on this device.";g(b);a(!1)};try{if(null===d&&b.isSupported())if(b.adapter=d=e.openDatabase(b.dbName,"",b.dbDescription,b.dbSize),String(d.version)!==String(b.dbVersion)&&d.changeVersion&&"function"===typeof d.changeVersion)try{d.changeVersion(d.version,
b.dbVersion,f,k)}catch(m){g(m),a(!1)}else d=e.openDatabase(b.dbName,b.dbVersion,b.dbDescription,b.dbSize),c(d);else b.isSupported()&&a(d)}catch(n){g(n),a(!1)}},init:function(a){return this.isSupported()?(a&&(a.description&&(this.dbDescription=a.description),a.name&&(this.dbName=a.name),a.size&&(this.dbSize=a.size),a.table&&(this.dbTable=a.table),a.version&&(this.dbVersion=String(a.version))),this):!1}};n.namespace("cache.storage.adapter."+m,f)})(window,window.app||{});(function(e,n,r){function l(a){!a&&e.event&&(a=e.event);k("["+m+" Adapter] Event - key: "+(a.key||"no e.key event")+", url: "+(a.url||"no e.url event"))}function g(a){var d="localStorage";switch(a){case "local":d="localStorage";break;case "session":d="sessionStorage"}return d}function f(a){this.adapter=null;this.type=m;this.lifetime="local";this.init(a)}var m="webStorage";r=n.helpers.utils;var c=r.on,k=r.log,a=null;f.prototype=f.fn={isSupported:function(){var b=g(this.lifetime);if(null===a)try{a=
!!e[b]&&!!e[b].getItem}catch(d){k("["+m+" Adapter] "+m+" is not supported"),a=!1}return a},create:function(a,d,c){try{this.adapter.setItem(a,d),c(!0)}catch(e){l(e),c(!1,e)}},read:function(a,d){var c;try{(c=this.adapter.getItem(a))?d(c):d(!1)}catch(e){l(e),d(!1,e)}},update:function(a,d,c){this.create(a,d,c)},remove:function(a,d){try{this.adapter.removeItem(a),d(a)}catch(c){l(c),d(!1,c)}},open:function(a){var d=this,f=d.adapter,q=g(d.lifetime);if(null===f)try{f=d.adapter=e[q],c(e,"storage",l),k("["+
m+" Adapter] Try to create test resource"),d.create("test-item",'{test: "test-content"}',function(c){c?d.remove("test-item",function(){k("["+m+" Adapter] Test resource created and successfully deleted");a(f)}):a(!1)})}catch(t){a(!1)}else d.isSupported()&&a(f)},init:function(a){return this.isSupported()?(a&&a.lifetime&&(this.lifetime=a.lifetime),this):!1}};n.namespace("cache.storage.adapter."+m,f)})(window,window.app||{});(function(e,n,r,l){function g(){this.adapter=null;this.type=f;this.isLoaded=!1;this.delay=25;this.init()}var f="applicationCache",m=r.helpers.utils,c=m.on,k=m.log,a=m.callback,b=null,d=n.getElementsByTagName("html")[0];g.prototype=g.fn={isSupported:function(){null===b&&((b=!!e.applicationCache&&!!m.getAttribute(d,"manifest"))||k("["+f+" Adapter] "+f+" is not supported or there is no manifest html attribute"));return b},loaded:function(a){this.isLoaded||(this.isLoaded=!0,e.setTimeout(function(){a()},
this.delay))},open:function(b){var d=this,g=d.adapter,m=0,r;b=a(b);if(d.isSupported()&&null!==g){r=function(){k("["+f+" Adapter] Event updateready");try{g.swapCache()}catch(a){k("["+f+" Adapter] Event updateready: swapcache is not available")}confirm("A new version of this website is available. Do you want to an update?")?e.location.reload(!0):d.loaded(b);return!1};c(g,"checking",function(){k("["+f+" Adapter] Event checking");return!1});c(g,"noupdate",function(){k("["+f+" Adapter] Event noupdate");
d.loaded(b);return!1});c(g,"downloading",function(){k("["+f+" Adapter] Event downloading");m=0;return!1});c(g,"progress",function(a){k("["+f+" Adapter] Event progress");var b="",c=n.getElementById("layer-loading-bar");d.delay=500;m+=1;b=a&&a.lengthComputable!==l?" "+Math.round(100*a.loaded/a.total)+"%":" "+Math.round(100*m/20)+"%";c&&(c.style.width=b);return!1});c(g,"cached",function(){k("["+f+" Adapter] Event cached");d.loaded(b);return!1});c(g,"updateready",function(){r()});c(g,"obsolete",function(){k("["+
f+" Adapter] Event obsolete");e.location.reload(!0);return!1});c(g,"error",function(){k("["+f+" Adapter] Event error");d.loaded(b);return!1});switch(g.status){case g.UNCACHED:d.loaded(b);break;case g.IDLE:d.loaded(b);break;case g.UPDATEREADY:r();break;case g.OBSOLETE:d.loaded(b)}c(e,"online",function(){try{g.update()}catch(a){k("["+f+" Adapter] Window event online: update cache is not available")}});e.setTimeout(function(){d.isLoaded||d.loaded(b)},12E3)}else d.loaded(b)},init:function(){var a=this.adapter;
this.isSupported()&&null===a&&(this.adapter=e.applicationCache);return this}};r.namespace("cache.storage.adapter."+f,g)})(window,document,window.app||{});(function(e,n,r){function l(a){return t.jsonToString(a)}function g(a){var b=null;try{b=t.jsonToObject(a)}catch(c){s("["+d+" controller] Couldn't convert json string to object."+c)}return b}function f(a,b,d){if(q.hasCanvas()){var c=e.createElement("canvas"),h,f=new Image,g=null,k=0,m=0;d||(d="jpeg");f.onload=function(){k=c.height=f.height;m=c.width=f.width;h=c.getContext("2d");h.fillStyle="rgba(50, 50, 50, 0)";h.fillRect(0,0,m,k);h.drawImage(f,0,0);g=c.toDataURL("image/"+d);b(g)};f.src=a}else b(!1)}
function m(a){return{ajax:a.ajax,data:a.data,expires:(new Date).getTime()+(a.lifetime||x.lifetime),group:a.group||x.group,lastmod:a.lastmod||x.lastmod,lifetime:a.lifetime||x.lifetime,type:a.type||x.type,version:a.version||x.version}}function c(a){return z&&z[a]?!!z[a]:!1}function k(a,b){var c=null,e;a&&a.length?(e=a[0].type,s("["+d+" controller] Testing for storage adapter type: "+e),u[e]?c=new u[e](v):k(a.slice(1),b),c&&c.isSupported()?c.open(function(h){h?(y=e,z=a[0],s("["+d+" controller] Used storage adapter type: "+
y),b(c)):k(a.slice(1),b)}):k(a.slice(1),b)):y||b(!1)}function a(b,c){var e=null,h=0,f;if(c)try{s("["+d+" controller] Testing for storage adapter type: "+c),u[c]?e=new u[c](v):a(b),e&&e.isSupported()?e.open(function(g){if(g){y=c;f=A.length;for(h=0;h<f;h+=1)A[h].type===c&&(z=A[h]);z?(s("["+d+" controller] Used storage type: "+y),b(e)):(s("["+d+" controller] Storage config not found: "+y),a(b))}else a(b)}):a(b)}catch(g){s("["+d+" controller] Storage adapter could not be initialized: type "+c),a(b)}else k(A,
b)}function b(a,b){this.isEnabled=!0;this.adapter=null;this.adapters={types:A,defaults:v};this.appCacheAdapter=null;this.resourceDefaults=x;this.init(a,b)}var d="storage",p=n.helpers,q=p.client,t=p.utils,s=t.log,w=t.callback,h=t.getJson(),B=t.xhr,u=n.cache.storage.adapter,A=[{type:"webStorage",css:!0,js:!0,html:!1,img:!1}],v={name:"localcache",table:"cache",description:"local resource cache",size:4194304,version:"1.0",key:"key",lifetime:"local",offline:!0},y=null,z=null,x={ajax:!0,lifetime:2E4,group:0,
lastmod:(new Date).getTime(),type:"css",version:1};b.prototype=b.fn={create:function(a,b){var e=this,h=a.url,g=a.type,k=function(f){a.data=f;if(null!==e.adapter&&c(g)){f=l(h);var k=l(m(a));try{e.adapter.create(f,k,function(c){c?(s("["+d+" controller] Create new resource in storage adapter: type "+g+", url "+h),b(a)):(s("["+d+" controller] Create new resource in storage adapter failed"),b(!1))})}catch(q){b(a)}}else s("["+d+" controller] Trying to create new resource, but resource type is not cachable or storage adapter is not available: type "+
g+", url "+h),b(a)};b=w(b);a.ajax?"img"===g?f(h,k):B(h,k):a.data&&k(a.data)},read:function(a,b){var e=this,h=a.url,f=a.type;b=w(b);if(null!==this.adapter&&c(f)){s("["+d+" controller] Trying to read resource from storage: type "+f+", url "+h);try{e.adapter.read(l(h),function(c){c?(a=g(c))?(a.url=h,s("["+d+" controller] Successfully read resource from storage: type "+f+", url "+h),b(a)):e.adapter.remove(l(h),function(){s("["+d+" controller] Resource deleted from storage adapter to create a new one: type "+
f+", url "+h);b(!1)}):(s("["+d+" controller] There is no data coming back from storage while reading: type "+f+", url "+h),b(!1))})}catch(k){B(h,function(c){a.data=c;s("["+d+" controller] Try to read resource from storage, but storage adapter is not available: type "+f+", url "+h);b(a)})}}else b(a)},update:function(a,b){var e=this,h=a.url,g=a.type,k=function(f){a.data=f;if(null!==e.adapter&&c(g)){f=l(h);var k=l(m(a));try{e.adapter.update(f,k,function(c){c?(s("["+d+" controller] Update existing resource in storage adapter: type "+
g+", url "+h),b(a)):(s("["+d+" controller] Updating resource in storage failed."),b(!1))})}catch(q){b(a)}}else s("["+d+" controller] Resource type is not cachable or storage adapter is not available: type "+g+", url "+h),b(a)};b=w(b);a.ajax?"img"===a.type?f(h,k):B(h,k):a.data&&k(a.data)},remove:function(a,b){var h=a.url,e=a.type;b=w(b);null!==this.adapter&&c(e)?this.adapter.remove(l(h),function(c){(a=g(c))?(a.url=h,s("["+d+" controller] Delete resource form storage: type "+e+", url "+h),b(a)):b(!1)}):
(s("["+d+" controller] Delete resource from storage failed, resource type is not cachable or there is no storage adapter: type "+e+", url "+h),b(a))},init:function(b,c){var e=this,f=!1;c&&c.isEnabled!==r&&(e.isEnabled=!!c.isEnabled);e.isEnabled&&h?(c&&(c.description&&(v.description=String(c.description)),c.key&&(v.key=String(c.key)),c.lifetime&&(v.lifetime=String(c.lifetime)),c.name&&(v.name=String(c.name)),c.size&&(v.size=parseInt(c.size,10)),c.table&&(v.table=String(c.table)),c.type&&(v.type=f=
String(c.type)),c.offline&&(v.offline=Boolean(c.offline)),c.version&&(v.version=String(c.version))),v.offline&&u.applicationCache&&(e.appCacheAdapter=new u.applicationCache(v)),a(function(a){e.adapter=a;b(e)},f)):(h||s("["+d+" controller] There is no json support"),e.isEnabled||s("["+d+" controller] Caching data is disabled"),b(e))}};n.namespace("cache.storage.controller",b)})(document,window.app||{});(function(e,n,r,l){function g(c,a){this.storage=null;this.init(c,a)}e=r.helpers;var f=e.append;e=e.utils;var m=e.log,c=e.callback;g.prototype=g.fn={load:function(e,a){var b=this,d=(new Date).getTime(),g=function(){var a=0,b=0,c=null;return{init:function(d,e){c=e;a=d;b=0},loaded:function(){b+=1;b===a&&c()}}}(),q=function(a,b){var c=a.url,d=function(){g.loaded()},e=a.node||null;switch(a.type){case "js":f.appendJs(c,b,d,e);break;case "css":f.appendCss(c,b,d,e);break;case "img":f.appendImg(c,b,d,e);break;
case "html":f.appendHtml(c,b,d,e)}},n=function(a){var c=a.data||null,e=function(a){a&&a.data?q(a,a.data):q(a)},f=b.storage.resourceDefaults,g=!0,k,p,n;a.version=a.version?parseFloat(a.version):f.version;a.group=a.group?parseFloat(a.group):f.group;a.ajax=a.ajax!==l?!!a.ajax:f.ajax;b.storage.read(a,function(l){a.lastmod&&l&&l.lastmod?(a.lastmod=parseInt(a.lastmod,10),g=l.lastmod===a.lastmod):a.lastmod=!a.lastmod&&l&&l.lastmod?l.lastmod:f.lastmod;l&&l.data?(k=parseInt(l.lifetime,10),p=l.version,n=a.version,
-1!==k&&g&&n===p&&l.expires>d||-1===k&&g&&n===p?(m("[cache controller] Resource is up to date: type "+a.type+", url "+a.url),(c=l.data)&&q(a,c)):(m("[cache controller] Resource is outdated and needs update: type "+a.type+", url "+a.url),b.storage.update(a,e))):(m("[cache controller] Resource or resource data is not available in storage adapter: type "+a.type+", url "+a.url),b.storage.create(a,e))})},r=function(a,b){var c=0,d=a.length,e=null;g.init(d,b);for(c=0;c<d;c+=1)(e=a[c])&&e.url&&n(e)},w=function(a,
b,c){var d=a.length;for(c||(c=0);!a[c]&&c<d;)c+=1;c>=d?b():(d=a[c],r(d,function(){w(a,b,c+1)}))};m("[cache controller] Load resource function called: resources count "+e.length);w(function(a){for(var b=[],c,d=0,e,f=a.length,d=0;d<f;d+=1)e=a[d],(c=e.group)||(c=0),c=b[c]?b[c]:b[c]=[],c.push(e);return b}(e),c(a))},init:function(e,a){var b=this;e=c(e);m("[cache controller] Cache initializing and checking for storage adapters");new r.cache.storage.controller(function(a){b.storage=a;e(a)},a)}};r.namespace("cache.controller",
g)})(window,document,window.app||{});(function(e,n,r){function l(b){this.storage=this.controller=null;this.params=b;this.queue=new a;this.calls=0}function g(a){var c=null,e,f=b.length;a||(a={});for(e=0;e<f;e+=1)k(b[e].params)===k(a)&&(c=b[e]);c||(c=new l(a),b.push(c));return c}var f=n.cache.controller;r=n.helpers;var m=r.utils,c=m.isArray,k=m.jsonToString,a=r.queue,b=[];n.namespace("cache.load",function(a,b,k){var l=g(k),m=function(a,b,d){c(a)?l.controller.load(a,b):"applicationCache"===a&&((a=l.storage)&&a.appCacheAdapter?a.appCacheAdapter.open(b):
b())};l.storage?m(a,b,k):(l.queue.add(function(){m(a,b,k)}),l.calls+=1,1===l.calls&&(l.controller=new f(function(a){l.storage=a;l.controller?l.queue.flush(this):l.interval=e.setInterval(function(){l.controller&&(e.clearInterval(l.interval),l.queue.flush(this))},25)},k)));return this})})(window,window.app||{});
