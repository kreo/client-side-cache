(function(b,n,q){n.namespace=function(b,g){if(b){b=String(b);var e=b.split("."),p=e.length,k=n,h;for(h=0;h<p;h+=1)k[e[h]]||(k[e[h]]={},h===p-1&&g&&(k[e[h]]=g)),k=k[e[h]];return k}return!1};b.app=n})(window,window.app||{});(function(b,n,q,l){var g=function(){var e=null,p=b.console!==l&&b.console.log,k=b.console!==l&&console.time!==l&&console.timeEnd!==l,h=[];return{logToScreen:function(a){var c=n.getElementById("log"),d=n.createElement("p");a=n.createTextNode(a);c&&(d.appendChild(a),c.appendChild(d))},log:function(a){p&&b.console.log(a);g.logToScreen(a)},logTimerStart:function(a){k&&b.console.time(a)},logTimerEnd:function(a){k&&b.console.timeEnd(a)},on:function(a,c,d){g.on="function"===typeof b.addEventListener?function(f,
a,c){f.addEventListener(a,c,!1)}:"function"===typeof n.attachEvent?function(f,a,c){f.attachEvent("on"+a,c)}:function(f,a,c){f["on"+a]=c};g.on(a,c,d)},off:function(a,c,d){g.off="function"===typeof b.removeEventListener?function(f,a,c){f.removeEventListener(a,c,!1)}:"function"===typeof n.detachEvent?function(f,a,c){f.detachEvent("on"+a,c)}:function(f,a){f["on"+a]=null};g.off(a,c,d)},createDomNode:function(a,c){var d=n.createElement(a),f;if(c)for(f in c)c.hasOwnProperty(f)&&d.setAttribute(f,c[f]);return d},
getXhr:function(){for(var a=null,c=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],d=c.length,f=0,f=0;f<d;f+=1){try{a=c[f]()}catch(s){continue}break}return a},xhr:function(a,c,d){var f=g.getXhr(),s,w="GET";f?(d!==l?w="POST":d=null,s=function(){if(4===f.readyState&&(200<=f.status&&400>f.status||0===f.status))try{var a=f.responseText;a?c(a):
c(!1)}catch(d){c(!1)}},f.open(w,a,!0),f.onreadystatechange!==l?f.onreadystatechange=s:f.onload!==l&&(f.onload=s),f.send(d)):c(!1)},getJson:function(){null===e&&(b.JSON&&b.JSON.stringify)&&(e=b.JSON);return e},jsonToString:function(a){var c=!1;null===e&&(e=g.getJson());e&&a&&(c=e.stringify(a));return c},jsonToObject:function(a){var c=!1;null===e&&(e=g.getJson());e&&a&&(c=e.parse(a));return c},url:function(a){if(a){var c=n.createElement("a"),d;c.href=a;d=c.pathname.match(/\/([^\/?#]+)$/i);var f=c.protocol,
s=c.hostname,w=c.port,b=c.search;d=d?d[1]:"/";var k=c.hash,c=c.pathname.replace(/^([^\/])/,"/$1"),m=a.lastIndexOf("/"),m=a.substr(0,m+1);return{source:a,protocol:f,host:s,port:w,query:b,file:d,hash:k,path:c,folder:m}}},callback:function(a){a&&"function"===typeof a||(a=function(){});return a},isArray:function(a){return a instanceof Array},inArray:function(a,c,d){return Array.prototype.indexOf?h.indexOf.call(c,a,d):-1},hasClass:function(a,c){return RegExp(" "+c+" ").test(" "+a.className+" ")}}}();q.namespace("helpers.utils",
g)})(window,document,window.app||{});(function(b,n){function q(){this.methods=[];this.response=null;this.flushed=!1}q.prototype=q.fn={add:function(b){this.flushed?b(this.response):this.methods.push(b)},flush:function(b){if(!this.flushed)for(this.response=b,this.flushed=!0;this.methods[0];)this.methods.shift()(b)}};b.namespace("helpers.queue",q)})(window.app||{});(function(b,n,q,l){var g=function(){function e(){switch(parseInt(b.orientation,10)){case 0:y=A;break;case 180:y=A;break;case 90:y=B;break;case -90:y=B}}function g(){var f=n.connection||n.mozConnection||n.webkitConnection||{type:0,UNKNOWN:0,ETHERNET:1,WIFI:2,CELL_2G:3,CELL_3G:4},a=function(){u=f};f.onchange=a;a()}var k,h,a,c,d,f,s,w,r,x,m,z,t,C,u,B="landscapeMode",A="portraitMode",y,E,F,v=n.userAgent||n.vendor||b.opera,D=q.helpers.utils.on;return{isiOS:function(){k===l&&(k=null!==v.toLowerCase().match(/(iphone|ipod|ipad)/))&&
D(b,"orientationchange",e);return k},isWebkit:function(){h===l&&(h=null!==v.toLowerCase().match(/(webkit)/));return h},isAndroid:function(){a===l&&(a=null!==v.toLowerCase().match(/(android)/))&&D(b,"orientationchange",e);return a},isBlackberry:function(){c===l&&(c=null!==v.toLowerCase().match(/(blackberry)/))&&D(b,"orientationchange",e);return c},isChrome:function(){f===l&&(f=null!==v.toLowerCase().match(/(chrome)/));return f},isOpera:function(){d===l&&(d=null!==v.toLowerCase().match(/(opera)/));
return d},isSafari:function(){s===l&&(s=null!==v.toLowerCase().match(/(safari)/));return s},isFirefox:function(){w===l&&(w=null!==v.toLowerCase().match(/(firefox)/));return w},isSeamonkey:function(){r===l&&(r=null!==v.toLowerCase().match(/(seamonkey)/));return r},isCamino:function(){x===l&&(x=null!==v.toLowerCase().match(/(camino)/));return x},isMsie:function(){m===l&&(m=null!==v.toLowerCase().match(/(msie)/));return m},isiPad:function(){z===l&&(z=null!==v.toLowerCase().match(/(ipad)/))&&D(b,"orientationchange",
e);return z},isMobile:function(){if(t===l){t=!1;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(v)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(v.substr(0,
4)))t=!0;t&&D(b,"orientationchange",e)}return t},getBrowserVersion:function(){if(C===l){var f,a;(a=v.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i))&&null!==(f=v.match(/version\/([\.\d]+)/i))&&(a[2]=f[1]);C=a?a[2]:n.appVersion}return C},getNetworkConnection:function(){u===l&&g();return u},isStandalone:function(){return n.standalone!==l&&n.standalone},isOnline:function(){return n.onLine},orientation:function(){return b.orientation?b.orientation:0},orientationMode:function(){y===
l&&e();return y},hasRetinaDisplay:function(){return 2<=b.devicePixelRatio},hasCanvas:function(){if(E===l){var a=document.createElement("canvas");E=!(!a.getContext||!a.getContext("2d"))}return E},hideStatusbar:function(a){a||(a=0);b.clearTimeout(F);F=b.setTimeout(function(){0===parseInt(b.pageYOffset,10)&&b.scrollTo(0,1)},a)}}}();q.namespace("helpers.client",g)})(window,navigator,window.app||{});(function(b,n,q){function l(l,e){e&&(e.dom?l=e.dom:e.id&&(l=b.getElementById(e.id)));return l}q=function(){var g=n.helpers,e=g.utils,p=e.createDomNode,k=g.client,h=[],a=[],c=[],d=[],f=b.getElementsByTagName("head")[0];return{appendCss:function(a,c,d,x){if(-1===e.inArray(a,h)){var m,g;m=l(null,x);if(null!==c){m||(m=p("style",{type:"text/css"}));x||f.appendChild(m);try{g=b.createTextNode(c),m.appendChild(g)}catch(t){m.styleSheet.cssText=c}finally{d()}}else null!==a&&(m||(m=p("link",{rel:"stylesheet",
type:"text/css"})),x||f.appendChild(m),k.isMsie||k.isOpera?m.onload=d:d(),m.href=a);h.push(a)}else d()},appendJs:function(c,d,k,h){if(-1===e.inArray(c,a)){var m=p("script"),g=b.getElementsByTagName("script")[0],t=!1,m=l(m,h);m.type="text/javascript";m.async=!0;m.onreadystatechange=m.onload=function(){t||this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||(this.onreadystatechange=this.onload=null,t=!0,a.push(c),k())};m.onerror&&(m.onerror=function(){this.onload=this.onreadystatechange=
this.onerror=null;k()});h||(g?g.parentNode.insertBefore(m,g):f.appendChild(m));d&&!t?(m.textContent?m.textContent=d:m.nodeValue?m.nodeValue=d:m.text=d,t=!0):null!==c&&(m.src=c);t&&(a.push(c),k())}else k()},appendImg:function(a,f,d,b){(b=l(null,b))||(b=new Image);b.onload=d;f?b.src=f:a&&(b.src=a);c.push(a)},appendHtml:function(a,f,c,k){var m;if(m=l(null,k)){if(f)try{m.innerHTML=f,k.id&&b.styleSheets[0].addRule("#"+k.id+":after","content: ' ';")}catch(e){m.innerText=f}c();d.push(a)}else c()}}}();n.namespace("helpers.append",
q)})(document,window.app||{});(function(b,n,q){function l(f){var c="";switch(f.code){case FileError.QUOTA_EXCEEDED_ERR:c="["+k+" Adapter] File System Event: QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:c="["+k+" Adapter] File System Event: NOT_FOUND_ERR, file does not exist";break;case FileError.SECURITY_ERR:c="["+k+" Adapter] File System Event: SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:c="["+k+" Adapter] File System Event: INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:c="["+k+" Adapter] File System Event: INVALID_STATE_ERR";
break;default:c="["+k+" Adapter] File System Event: Unknown Error"}a(c)}function g(a,c,d){if("."===c[0]||""===c[0])c=c.slice(1);c[0]?a.getDirectory(c[0],{create:!0},function(a){c.length?g(a,c.slice(1),d):d()},l):d()}function e(a,d,b){d=d.split("/");var k=d.length,e="",m=0;b=c(b);if(k){for(m=0;m<k-1;m+=1)e=e+d[m]+"/";g(a.root,e.split("/"),b)}else b()}function p(a){this.adapter=null;this.type=k;this.size=52428800;this.init(a)}var k="fileSystem",h=n.helpers.utils,a=h.log,c=h.callback,d=null;p.prototype=
p.fn={isSupported:function(){null===d&&((d=(!!b.requestFileSystem||!!b.webkitRequestFileSystem)&&!!b.Blob)||a("["+k+" Adapter] "+k+" is not supported"));return d},open:function(c){var d=this,e=d.adapter;null===e?(b.requestFileSystem=b.requestFileSystem||b.webkitRequestFileSystem,b.requestFileSystem(b.TEMPORARY,d.size,function(b){e=d.adapter=b;a("["+k+" Adapter] Try to create test resource");try{d.create("test-item",h.jsonToString({test:"test-content"}),function(m){m?d.remove("test-item",function(){a("["+
k+" Adapter] Test resource created and successfully deleted");c(e)}):c(!1)})}catch(g){l(g),c(!1)}},l)):c(e)},create:function(a,c,d){var b=this.adapter,k=function(a){l(a);d(!1,a)};e(b,a,function(){b.root.getFile(a,{create:!0},function(a){a.createWriter(function(a){a.onwriteend=function(){d(!0)};a.onerror=k;try{var f=new Blob([c],{type:"text/plain"});a.write(f)}catch(b){k(b)}},k)},k)})},read:function(a,c){var d=this.adapter,b=function(a){l(a);c(!1,a)};e(d,a,function(){d.root.getFile(a,{create:!1},function(a){a.file(function(a){var d=
new FileReader;d.onloadend=function(){c(this.result)};d.readAsText(a)},b)},b)})},update:function(a,c,d){this.create(a,c,d)},remove:function(a,c){var d=this.adapter,b=function(d){l(d);c(a,d)};e(d,a,function(){d.root.getFile(a,{create:!1},function(a){a.remove(function(){c()},b)},b)})},init:function(a){return this.isSupported()?(a&&a.size&&(this.size=a.size),this):!1}};n.namespace("cache.storage.adapter."+k,p)})(window,window.app||{});(function(b,n,q){function l(b){this.adapter=null;this.type=g;this.dbName="merkel";this.dbVersion="1.0";this.dbTable="offline";this.dbDescription="Local cache";this.dbKey="key";this.init(b)}var g="indexedDatabase",e=n.helpers.utils.log,p=null;l.prototype=l.fn={isSupported:function(){null===p&&((p=!!b.indexedDB||!!b.webkitIndexedDB||!!b.mozIndexedDB||!!b.OIndexedDB||!!b.msIndexedDB)||e("["+g+" Adapter] "+g+" is not supported"));return p},create:function(b,h,a){var c=this.dbTable,d=this.dbName,f=this.adapter.transaction([c],
"readwrite");b=f.objectStore(c).put({key:b,content:h});f.onerror=function(c){e("["+g+" Adapter] Failed to init transaction while creating/updating database entry "+d+" "+c);a(!1,c)};b.onerror=function(c){e("["+g+" Adapter] Failed to create/update database entry "+d+" "+c);a(!1,c)};b.onsuccess=function(){a(!0)}},read:function(b,h){var a=this.dbTable,c=this.dbName,d=this.adapter.transaction([a],"readonly"),a=d.objectStore(a).get(b);d&&a?(d.onerror=function(a){e("["+g+" Adapter] Failed to init transaction while reading database "+
c+" "+a)},a.onerror=function(a){e("["+g+" Adapter] Failed to read database entry "+c+" "+a);h(!1,a)},a.onsuccess=function(a){a.target.result&&a.target.result.content?h(a.target.result.content):h(!1)}):h(!1)},update:function(b,e,a){this.create(b,e,a)},remove:function(b,h){var a=this.dbTable,c=this.dbName,d=this.adapter.transaction([a],"readwrite"),a=d.objectStore(a)(a).put({key:b,content:""});d.onerror=function(a){e("["+g+" Adapter] Failed to init transaction while deleting database entry "+c+" "+
a);h(!1,a)};a.onerror=function(a){e("["+g+" Adapter] Failed to delete database entry "+c+" "+a);h(!1,a)};a.onsuccess=function(){h(!0)}},open:function(k,h){var a=this,c=null,d=null,f=null,s=a.dbName,l=a.dbTable,n,p,m,z;h||(h=!1);if(null===a.adapter)if(c=b.indexedDB||b.webkitIndexedDB||b.mozIndexedDB||b.OIndexedDB||b.msIndexedDB){b.webkitIndexedDB!==q&&(b.IDBTransaction=b.webkitIDBTransaction,b.IDBKeyRange=b.webkitIDBKeyRange);n=function(c){var b=d.result;a.adapter=b;a.dbVersion===b.version||!b.setVersion&&
"function"!==typeof b.setVersion?k(b):(f=c.currentTarget.result.setVersion(a.dbVersion),f.onfailure=function(a){e("["+g+" Adapter] Failed to open database: "+s+" "+a);k(!1)},f.onsuccess=function(c){var b=d.result.createObjectStore(l,{keyPath:a.dbKey});e("["+g+" Adapter] Database needs upgrade: "+s+" "+c.oldVersion+" "+c.newVersion);b.createIndex("key","key",{unique:!0});b.createIndex("content","content",{unique:!1})})};p=function(c){var b=d.result.createObjectStore(l,{keyPath:a.dbKey});e("["+g+" Adapter] Database needs upgrade: "+
s+" "+c.oldVersion+" "+c.newVersion);b.createIndex("key","key",{unique:!0});b.createIndex("content","content",{unique:!1})};m=function(c){e("["+g+" Adapter] Failed to open database: "+s+" "+c);h||a.open(k,!0);k(!1)};z=function(a){e("["+g+" Adapter] Opening database request is blocked! "+s+" "+a);k(!1)};if(h)try{d=c.open(s,a.dbVersion)}catch(t){e(t),d=c.open(s)}else d=c.open(s);d.onsuccess=n;d.onupgradeneeded=p;d.onerror=m;d.onblocked=z}else k(!1);else k(a.adapter)},init:function(b){return this.isSupported()?
(b&&(b.name&&(this.dbName=b.name),b.version&&(this.dbVersion=b.version),b.table&&(this.dbTable=b.table),b.description&&(this.dbDescription=b.description),b.key&&(this.dbKey=b.key)),this):!1}};n.namespace("cache.storage.adapter."+g,l)})(window,window.app||{});(function(b,n,q){function l(a,c,d,b,e,k){!k&&a?a.transaction(function(a){a.executeSql(c,d,b,e)}):k?k.executeSql(c,d,b,e):e(null,{code:0,message:"The storage adapter isn't available"})}function g(a){var c="["+p+" Adapter] Errorcode: "+a.code+", Message: "+a.message;a.info&&(c=c+" - "+a.info);k(c)}function e(a){this.adapter=null;this.type=p;this.dbName="merkel";this.dbVersion="1.0";this.dbDescription="resource cache";this.dbTable="cache";this.dbSize=4194304;this.init(a)}var p="webSqlDatabase",k=n.helpers.utils.log,
h=null;e.prototype=e.fn={isSupported:function(){null===h&&((h=!!b.openDatabase)||k("["+p+" Adapter] "+p+" is not supported"));return h},create:function(a,c,d){l(this.adapter,"INSERT INTO "+this.dbTable+" (key, content) VALUES (?,?);",[a,c],function(){d(!0)},function(a,c){g(c);d(!1,c,{transaction:a})})},read:function(a,c){l(this.adapter,"SELECT content FROM "+this.dbTable+" WHERE key=?;",[a],function(a,b){var e=null;b&&(b.rows&&1===b.rows.length)&&(e=b.rows.item(0).content);c(e,null,{transaction:a})},
function(a,b){g(b);c(!1,b,{transaction:a})})},update:function(a,c,d){l(this.adapter,"UPDATE "+this.dbTable+" SET content = ?  WHERE key=?;",[c,a],function(){d(!0)},function(a,c){g(c);d(!1,c,{transaction:a})})},remove:function(a,c){l(this.adapter,"DELETE FROM "+this.dbTable+" WHERE key = ?;",[a],function(){c(!0)},function(a,b){g(b);c(!1,b,{transaction:a})})},open:function(a){var c=this,d=c.adapter,f=function(d,b){l(d,"CREATE TABLE IF NOT EXISTS "+c.dbTable+"(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, key TEXT NOT NULL UNIQUE, content TEXT NOT NULL);",
[],function(){a(d)},function(c){g(c);a(!1)},b)},e=function(a){f(null,a)},k=function(c){c.info="Can't migrate to new database version and using localStorage instead. This may be caused by non-standard implementation of the changeVersion method. Please switch back your database version to use webSql on this device.";g(c);a(!1)};try{if(null===d&&c.isSupported())if(c.adapter=d=b.openDatabase(c.dbName,"",c.dbDescription,c.dbSize),String(d.version)!==String(c.dbVersion)&&d.changeVersion&&"function"===typeof d.changeVersion)try{d.changeVersion(d.version,
c.dbVersion,e,k)}catch(h){g(h),a(!1)}else d=b.openDatabase(c.dbName,c.dbVersion,c.dbDescription,c.dbSize),f(d);else c.isSupported()&&a(d)}catch(n){g(n),a(!1)}},init:function(a){return this.isSupported()?(a&&(a.description&&(this.dbDescription=a.description),a.name&&(this.dbName=a.name),a.size&&(this.dbSize=a.size),a.table&&(this.dbTable=a.table),a.version&&(this.dbVersion=String(a.version))),this):!1}};n.namespace("cache.storage.adapter."+p,e)})(window,window.app||{});(function(b,n,q){function l(a){!a&&b.event&&(a=b.event);h("["+p+" Adapter] Event - key: "+(a.key||"no e.key event")+", url: "+(a.url||"no e.url event"))}function g(a){var d="localStorage";switch(a){case "local":d="localStorage";break;case "session":d="sessionStorage"}return d}function e(a){this.adapter=null;this.type=p;this.lifetime="local";this.init(a)}var p="webStorage";q=n.helpers.utils;var k=q.on,h=q.log,a=null;e.prototype=e.fn={isSupported:function(){var c=g(this.lifetime);if(null===a)try{a=
!!b[c]&&!!b[c].getItem}catch(d){h("["+p+" Adapter] "+p+" is not supported"),a=!1}return a},create:function(a,d,b){try{this.adapter.setItem(a,d),b(!0)}catch(e){l(e),b(!1,e)}},read:function(a,b){var f;try{(f=this.adapter.getItem(a))?b(f):b(!1)}catch(e){l(e),b(!1,e)}},update:function(a,b,f){this.create(a,b,f)},remove:function(a,b){try{this.adapter.removeItem(a),b(a)}catch(f){l(f),b(!1,f)}},open:function(a){var d=this,f=d.adapter,e=g(d.lifetime);if(null===f)try{f=d.adapter=b[e],k(b,"storage",l),h("["+
p+" Adapter] Try to create test resource"),d.create("test-item",'{test: "test-content"}',function(b){b?d.remove("test-item",function(){h("["+p+" Adapter] Test resource created and successfully deleted");a(f)}):a(!1)})}catch(n){a(!1)}else d.isSupported()&&a(f)},init:function(a){return this.isSupported()?(a&&a.lifetime&&(this.lifetime=a.lifetime),this):!1}};n.namespace("cache.storage.adapter."+p,e)})(window,window.app||{});(function(b,n,q,l){function g(){this.adapter=null;this.type=e;this.isLoaded=!1;this.delay=25;this.init()}var e="applicationCache",p=q.helpers.utils,k=p.on,h=p.log,a=p.callback,c=null,d=n.getElementsByTagName("html")[0];g.prototype=g.fn={isSupported:function(){null===c&&((c=!!b.applicationCache&&!!d.getAttribute("manifest"))||h("["+e+" Adapter] "+e+" is not supported or there is no manifest html attribute"));return c},loaded:function(a){this.isLoaded||(this.isLoaded=!0,b.setTimeout(function(){a()},
this.delay))},open:function(c){var d=this,g=d.adapter,p=0,q;c=a(c);if(d.isSupported()&&null!==g){q=function(){h("["+e+" Adapter] Event updateready");try{g.swapCache()}catch(a){h("["+e+" Adapter] Event updateready: swapcache is not available")}confirm("A new version of this website is available. Do you want to an update?")?b.location.reload(!0):d.loaded(c);return!1};k(g,"checking",function(){h("["+e+" Adapter] Event checking");return!1});k(g,"noupdate",function(){h("["+e+" Adapter] Event noupdate");
d.loaded(c);return!1});k(g,"downloading",function(){h("["+e+" Adapter] Event downloading");p=0;return!1});k(g,"progress",function(a){h("["+e+" Adapter] Event progress");var c="",b=n.getElementById("layer-loading-bar");d.delay=500;p+=1;c=a&&a.lengthComputable!==l?" "+Math.round(100*a.loaded/a.total)+"%":" "+Math.round(100*p/20)+"%";b&&(b.style.width=c);return!1});k(g,"cached",function(){h("["+e+" Adapter] Event cached");d.loaded(c);return!1});k(g,"updateready",function(){q()});k(g,"obsolete",function(){h("["+
e+" Adapter] Event obsolete");b.location.reload(!0);return!1});k(g,"error",function(){h("["+e+" Adapter] Event error");d.loaded(c);return!1});switch(g.status){case g.UNCACHED:d.loaded(c);break;case g.IDLE:d.loaded(c);break;case g.UPDATEREADY:q();break;case g.OBSOLETE:d.loaded(c)}k(b,"online",function(){try{g.update()}catch(a){h("["+e+" Adapter] Window event online: update cache is not available")}});b.setTimeout(function(){d.isLoaded||d.loaded(c)},12E3)}else d.loaded(c)},init:function(){var a=this.adapter;
this.isSupported()&&null===a&&(this.adapter=b.applicationCache);return this}};q.namespace("cache.storage.adapter."+e,g)})(window,document,window.app||{});(function(b,n,q){function l(a){return w.jsonToString(a)}function g(a){var c=null;try{c=w.jsonToObject(a)}catch(b){r("["+d+" controller] Couldn't convert json string to object."+b)}return c}function e(a,c,d){if(s.hasCanvas()){var e=b.createElement("canvas"),m,f=new Image,g=null,k=0,h=0;d||(d="jpeg");f.onload=function(){k=e.height=f.height;h=e.width=f.width;m=e.getContext("2d");m.fillStyle="rgba(50, 50, 50, 0)";m.fillRect(0,0,h,k);m.drawImage(f,0,0);g=e.toDataURL("image/"+d);c(g)};f.src=a}else c(!1)}
function p(a){return{ajax:a.ajax,data:a.data,expires:(new Date).getTime()+(a.lifetime||y.lifetime),group:a.group||y.group,lastmod:a.lastmod||y.lastmod,lifetime:a.lifetime||y.lifetime,type:a.type||y.type,version:a.version||y.version}}function k(a){return A&&A[a]?!!A[a]:!1}function h(a,c){var b=null,e;a&&a.length?(e=a[0].type,r("["+d+" controller] Testing for storage adapter type: "+e),t[e]?b=new t[e](u):h(a.slice(1),c),b&&b.isSupported()?b.open(function(m){m?(B=e,A=a[0],r("["+d+" controller] Used storage adapter type: "+
B),c(b)):h(a.slice(1),c)}):h(a.slice(1),c)):B||c(!1)}function a(c,b){var e=null,m=0,f;if(b)try{r("["+d+" controller] Testing for storage adapter type: "+b),t[b]?e=new t[b](u):a(c),e&&e.isSupported()?e.open(function(g){if(g){B=b;f=C.length;for(m=0;m<f;m+=1)C[m].type===b&&(A=C[m]);A?(r("["+d+" controller] Used storage type: "+B),c(e)):(r("["+d+" controller] Storage config not found: "+B),a(c))}else a(c)}):a(c)}catch(g){r("["+d+" controller] Storage adapter could not be initialized: type "+b),a(c)}else h(C,
c)}function c(a,c){this.isEnabled=!0;this.adapter=null;this.adapters={types:C,defaults:u};this.appCacheAdapter=null;this.resourceDefaults=y;this.init(a,c)}var d="storage",f=n.helpers,s=f.client,w=f.utils,r=w.log,x=w.callback,m=w.getJson(),z=w.xhr,t=n.cache.storage.adapter,C=[{type:"fileSystem",css:!0,js:!0,html:!0,img:!0},{type:"indexedDatabase",css:!0,js:!0,html:!0,img:!0},{type:"webSqlDatabase",css:1,js:1,html:1,img:0},{type:"webStorage",css:!0,js:!0,html:!1,img:!1}],u={name:"localcache",table:"cache",
description:"local resource cache",size:4194304,version:"1.0",key:"key",lifetime:"local",offline:!0},B=null,A=null,y={ajax:!0,lifetime:2E4,group:0,lastmod:(new Date).getTime(),type:"css",version:1};c.prototype=c.fn={create:function(a,c){var b=this,m=a.url,f=a.type,g=function(e){a.data=e;if(null!==b.adapter&&k(f)){e=l(m);var g=l(p(a));try{b.adapter.create(e,g,function(b){b?(r("["+d+" controller] Create new resource in storage adapter: type "+f+", url "+m),c(a)):(r("["+d+" controller] Create new resource in storage adapter failed"),
c(!1))})}catch(h){c(a)}}else r("["+d+" controller] Trying to create new resource, but resource type is not cachable or storage adapter is not available: type "+f+", url "+m),c(a)};c=x(c);a.ajax?"img"===f?e(m,g):z(m,g):a.data&&g(a.data)},read:function(a,c){var b=this,e=a.url,m=a.type;c=x(c);if(null!==this.adapter&&k(m)){r("["+d+" controller] Trying to read resource from storage: type "+m+", url "+e);try{b.adapter.read(l(e),function(f){f?(a=g(f))?(a.url=e,r("["+d+" controller] Successfully read resource from storage: type "+
m+", url "+e),c(a)):b.adapter.remove(l(e),function(){r("["+d+" controller] Resource deleted from storage adapter to create a new one: type "+m+", url "+e);c(!1)}):(r("["+d+" controller] There is no data coming back from storage while reading: type "+m+", url "+e),c(!1))})}catch(f){z(e,function(b){a.data=b;r("["+d+" controller] Try to read resource from storage, but storage adapter is not available: type "+m+", url "+e);c(a)})}}else c(a)},update:function(a,c){var b=this,m=a.url,f=a.type,g=function(e){a.data=
e;if(null!==b.adapter&&k(f)){e=l(m);var g=l(p(a));try{b.adapter.update(e,g,function(b){b?(r("["+d+" controller] Update existing resource in storage adapter: type "+f+", url "+m),c(a)):(r("["+d+" controller] Updating resource in storage failed."),c(!1))})}catch(h){c(a)}}else r("["+d+" controller] Resource type is not cachable or storage adapter is not available: type "+f+", url "+m),c(a)};c=x(c);a.ajax?"img"===a.type?e(m,g):z(m,g):a.data&&g(a.data)},remove:function(a,c){var b=a.url,e=a.type;c=x(c);
null!==this.adapter&&k(e)?this.adapter.remove(l(b),function(m){(a=g(m))?(a.url=b,r("["+d+" controller] Delete resource form storage: type "+e+", url "+b),c(a)):c(!1)}):(r("["+d+" controller] Delete resource from storage failed, resource type is not cachable or there is no storage adapter: type "+e+", url "+b),c(a))},init:function(c,b){var e=this,f=!1;b&&b.isEnabled!==q&&(e.isEnabled=!!b.isEnabled);e.isEnabled&&m?(b&&(b.description&&(u.description=String(b.description)),b.key&&(u.key=String(b.key)),
b.lifetime&&(u.lifetime=String(b.lifetime)),b.name&&(u.name=String(b.name)),b.size&&(u.size=parseInt(b.size,10)),b.table&&(u.table=String(b.table)),b.type&&(u.type=f=String(b.type)),b.offline&&(u.offline=Boolean(b.offline)),b.version&&(u.version=String(b.version))),u.offline&&t.applicationCache&&(e.appCacheAdapter=new t.applicationCache(u)),a(function(a){e.adapter=a;c(e)},f)):(m||r("["+d+" controller] There is no json support"),e.isEnabled||r("["+d+" controller] Caching data is disabled"),c(e))}};
n.namespace("cache.storage.controller",c)})(document,window.app||{});(function(b,n,q,l){function g(b,a){this.storage=null;this.init(b,a)}b=q.helpers;var e=b.append;b=b.utils;var p=b.log,k=b.callback;g.prototype=g.fn={load:function(b,a){var c=this,d=(new Date).getTime(),f=function(){var a=0,c=0,b=null;return{init:function(d,e){b=e;a=d;c=0},loaded:function(){c+=1;c===a&&b()}}}(),g=function(a,c){var b=a.url,d=function(){f.loaded()},g=a.node||null;switch(a.type){case "js":e.appendJs(b,c,d,g);break;case "css":e.appendCss(b,c,d,g);break;case "img":e.appendImg(b,c,d,g);break;
case "html":e.appendHtml(b,c,d,g)}},n=function(a){var b=a.data||null,e=function(a){a&&a.data?g(a,a.data):g(a)},f=c.storage.resourceDefaults,k=!0,h,n,q;a.version=a.version?parseFloat(a.version):f.version;a.group=a.group?parseFloat(a.group):f.group;a.ajax=a.ajax!==l?!!a.ajax:f.ajax;c.storage.read(a,function(l){a.lastmod&&l&&l.lastmod?(a.lastmod=parseInt(a.lastmod,10),k=l.lastmod===a.lastmod):a.lastmod=!a.lastmod&&l&&l.lastmod?l.lastmod:f.lastmod;l&&l.data?(h=parseInt(l.lifetime,10),n=l.version,q=a.version,
-1!==h&&k&&q===n&&l.expires>d||-1===h&&k&&q===n?(p("[cache controller] Resource is up to date: type "+a.type+", url "+a.url),(b=l.data)&&g(a,b)):(p("[cache controller] Resource is outdated and needs update: type "+a.type+", url "+a.url),c.storage.update(a,e))):(p("[cache controller] Resource or resource data is not available in storage adapter: type "+a.type+", url "+a.url),c.storage.create(a,e))})},q=function(a,c){var b=0,d=a.length,e=null;f.init(d,c);for(b=0;b<d;b+=1)(e=a[b])&&e.url&&n(e)},x=function(a,
b,c){var d=a.length;for(c||(c=0);!a[c]&&c<d;)c+=1;c>=d?b():(d=a[c],q(d,function(){x(a,b,c+1)}))};p("[cache controller] Load resource function called: resources count "+b.length);x(function(a){for(var c=[],b,d=0,e,f=a.length,d=0;d<f;d+=1)e=a[d],(b=e.group)||(b=0),b=c[b]?c[b]:c[b]=[],b.push(e);return c}(b),k(a))},init:function(b,a){var c=this;b=k(b);p("[cache controller] Cache initializing and checking for storage adapters");new q.cache.storage.controller(function(a){c.storage=a;b(a)},a)}};q.namespace("cache.controller",
g)})(window,document,window.app||{});(function(b,n,q){function l(b){this.storage=this.controller=null;this.params=b;this.queue=new a;this.calls=0}function g(a){var b=null,e,g=c.length;a||(a={});for(e=0;e<g;e+=1)h(c[e].params)===h(a)&&(b=c[e]);b||(b=new l(a),c.push(b));return b}var e=n.cache.controller;q=n.helpers;var p=q.utils,k=p.isArray,h=p.jsonToString,a=q.queue,c=[];n.namespace("cache.load",function(a,c,l){var h=g(l),n=function(a,b,c){k(a)?h.controller.load(a,b):"applicationCache"===a&&((a=h.storage)&&a.appCacheAdapter?a.appCacheAdapter.open(b):
b())};h.storage?n(a,c,l):(h.queue.add(function(){n(a,c,l)}),h.calls+=1,1===h.calls&&(h.controller=new e(function(a){h.storage=a;h.controller?h.queue.flush(this):h.interval=b.setInterval(function(){h.controller&&(b.clearInterval(h.interval),h.queue.flush(this))},25)},l)));return this})})(window,window.app||{});
