(function(h,r){function q(){h[k]||(h[k]={});return h[k]}var k="app",g;g=q();g.namespace=g.ns=function(g,n){if(g){g=String(g);var f=g.split("."),d=f.length,b=h[k],a;b||(h[k]={});if(!f)return!1;for(a=0;a<d;a+=1)b[f[a]]||(b[f[a]]={}),a===d-1&&n!==r&&(b[f[a]]=n),b=b[f[a]];return b}return!1};h[k]=g;h.getNamespace=h.getNs=q})(window);
(function(h,r){function q(){if(!(this instanceof q))return new q;this.m=[];this.r=null;this.f=!1}q.prototype=q.fn={add:function(k){this.f?k(this.r):this.m.push(k)},flush:function(k){if(!this.f)for(this.r=k,this.f=!0;this.m[0];)this.m.shift()(k)}};h.ns("helpers.queue",q)})(window.getNs());
(function(h,r,q,k){var g=function(){var l=null,n=[];return{isString:function(f){return"string"===typeof f||f instanceof String},isFunction:function(f){return"function"===typeof f||f instanceof Function},isArray:function(f){var d=Array.isArray,b=Object.prototype.toString;g.isArray=d&&"function"===typeof d?function(a){return d(a)}:b&&"function"===b?function(a){return"[object Array]"===b.call(a)}:function(a){return!!a&&!!a.sort&&"function"===typeof a.sort};return g.isArray(f)},inArray:function(f,d,b){g.inArray=
Array.prototype.indexOf?function(a,c,e){return n.indexOf.call(c,a,e)}:function(a,c,e){var b=c.length,d=0;if(e)return c[e]&&c[e]===a?e:-1;for(d=0;d<b;d+=1)if(c[d]===a)return d;return-1};return g.inArray(f,d,b)},callback:function(f){g.isFunction(f)||(f=function(){return k});return f},on:function(f,d,b){g.on="function"===typeof h.addEventListener?function(a,c,e){a.addEventListener(c,e,!1)}:"function"===typeof r.attachEvent?function(a,c,e){a.attachEvent("on"+c,e)}:function(a,c,e){a["on"+c]=e};g.on(f,
d,b)},off:function(f,d,b){g.off="function"===typeof h.removeEventListener?function(a,c,e){a.removeEventListener(c,e,!1)}:"function"===typeof r.detachEvent?function(a,c,e){a.detachEvent("on"+c,e)}:function(a,c){a["on"+c]=null};g.off(f,d,b)},getXhr:function(){for(var f=null,d=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=d.length,a=0,a=0;a<
b;a+=1){try{f=d[a]()}catch(c){continue}break}return f},xhr:function(f,d,b,a){var c=g.getXhr(),e,y="GET";d=g.callback(d);if(c)if(f){a!==k?y="POST":a=null;b===k&&(b=!0);e=function(){if(4===c.readyState&&(200<=c.status&&400>c.status||0===c.status))try{var a=c.responseText;a?d(a):d(!1)}catch(e){d(!1)}else 4===c.readyState&&d(!1)};c.open(y,f,b);try{c.onreadystatechange!==k?c.onreadystatechange=e:c.onload!==k&&(c.onload=e)}catch(z){}c.send(a)}else d(!1);else d(!1)},getJson:function(){null===l&&(h.JSON&&
h.JSON.stringify)&&(l=h.JSON);return l},jsonToString:function(f){var d=!1;null===l&&(l=g.getJson());l&&f!==k&&(d=l.stringify(f));return d},jsonToObject:function(f){var d=!1;null===l&&(l=g.getJson());l&&f!==k&&(d=l.parse(f));return d},url:function(f){if(g.isString(f)){var d=r.createElement("a"),b;d.href=f;b=d.pathname.match(/\/([^\/?#]+)$/i);return{source:f,protocol:d.protocol,host:d.hostname,port:d.port,query:d.search,file:b?b[1]:"/",hash:d.hash,path:d.pathname.replace(/^([^\/])/,"/$1"),extension:function(a){a=
a.split(".");return a.length?a[a.length-1]:!1}(f),folder:function(){var a=f.lastIndexOf("/");return f.substr(0,a+1)}()}}},trim:function(f){if(!g.isString(f))return f;g.isFunction(String.prototype.trim)||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});return f.trim()}}}();q.ns("helpers.utils",g)})(window,document,window.getNs());
(function(h,r,q,k){var g=function(){function g(){d===k&&(c(h,"online",g),c(h,"offline",g));d=r.onLine!==k?!!r.onLine:!0}var n,f,d,b,a=(r.userAgent||r.vendor||h.opera).toLowerCase(),c=q.helpers.utils.on;return{isMsie:function(){f===k&&(f=null!==a.match(/(msie)/));return f},isOpera:function(){n===k&&(n=null!==a.match(/(opera)/));return n},isOnline:function(){d===k&&g();return d},hasCanvas:function(){if(b===k){var a=document.createElement("canvas");b=!(!a.getContext||!a.getContext("2d"))}return b}}}();
q.ns("helpers.client",g)})(window,window.navigator,window.getNs());
(function(h,r,q){function k(g,k){k&&(k.dom?g=k.dom:k.id&&(g=h.getElementById(k.id)));return g}var g=function(){var l=r.helpers,n=l.utils,f=l.client,d=[],b=[],a=[],c=[],e=h.getElementsByTagName("head")[0];return{nuke:function(){d=[];b=[];a=[];c=[]},createDomNode:function(a,c){var e=h.createElement(a),b;if(c)for(b in c)c.hasOwnProperty(b)&&e.setAttribute(b,c[b]);return e},getAttribute:function(a,c){return a.getAttribute(c)},setAttribute:function(a,c,e){a.setAttribute(c,e)},appendCss:function(a,c,b,
w,p){if(-1===n.inArray(a,d)||p){var m=null,l=!1,t,u,m=k(m,w);if(null!==c){m||(m=g.createDomNode("style",{type:"text/css"}),m.className="lazyloaded");m.onerror=function(){b(!1)};w||e.appendChild(m);try{t=h.createTextNode(c),m.appendChild(t)}catch(B){m.styleSheet.cssText=c}finally{b(!0)}}else null!==a&&(m||(m=g.createDomNode("link",{rel:"stylesheet",type:"text/css"}),m.className="lazyloaded"),m.onerror=m.error=function(){m.onload=m.load=null;l=!0;window.clearTimeout(u);b(!1)},w||e.appendChild(m),f.isMsie()||
f.isOpera()?m.onload=m.load=function(){m.onerror=m.error=null;l=!0;window.clearTimeout(u);b(!0)}:b(!0),m.href=a,u=window.setTimeout(function(){l||b(!1)},4E3));d.push(a)}else b(!0)},appendJs:function(a,c,d,f,p){if(-1===n.inArray(a,b)||p){p=g.createDomNode("script");var m=h.getElementsByTagName("script")[0],l=!1,t=!1,u;(p=k(p,f))?(p.type="text/javascript",p.className="lazyloaded",p.async=!0,p.onreadystatechange=p.onload=function(){t||this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||
(this.onreadystatechange=this.onload=null,l=t=!0,window.clearTimeout(u),b.push(a),d(!0))},p.onerror=function(){this.onload=this.onreadystatechange=this.onerror=null;window.clearTimeout(u);l=!0;d(!1)},f||(m?m.parentNode.insertBefore(p,m):e.appendChild(p)),c&&!t?(p.textContent?p.textContent=c:p.nodeValue?p.nodeValue=c:p.text=c,l=t=!0):null!==a&&(p.src=a),t&&(b.push(a),l=!0,d(!0)),l||(u=window.setTimeout(function(){t||d(!1)},5E3))):d(!1)}else d(!0)},appendImg:function(c,e,b,d){var p=null;(p=k(p,d))||
(p=new Image);p.onerror=function(){p.onload=p.onerror=null;b(!1)};p.onload=function(){p.onload=p.onerror=null;b(!0)};e?p.src=e:c&&(p.src=c);if(p.complete&&p.naturalWidth!==q)p.onload();a.push(c)},appendHtml:function(a,e,b,d){var p=k(null,d);if(p){if(e)try{p.innerHTML=e,d.id&&f.isMsie()&&h.styleSheets[0].addRule("#"+d.id+":after",'content: " ";')}catch(m){p.innerText=e}b(!0);c.push(a)}else b(!1)}}}();r.ns("helpers.dom",g)})(document,window.getNs());
(function(h,r,q){function k(a,e,b){var d=function(a){b(!1)};if("."===e[0]||""===e[0])e=e.slice(1);e[0]?a.getDirectory(e[0],{create:!0},function(a){e.length?k(a,e.slice(1),b):b(!0)},d):b(!0)}function g(a,e,b){e=e.split("/");var f=e.length,s="",g=0;b=d(b);if(f){for(g=0;g<f-1;g+=1)s=s+e[g]+"/";k(a.root,s.split("/"),b)}else b(!0)}function l(a){if(!(this instanceof l))return new l(a);this.adapter=null;this.type=n;this.size=52428800;this.init(a)}var n="fileSystem",f=r.helpers.utils,d=f.callback,b=null,
a=h.requestFileSystem||h.webkitRequestFileSystem||h.moz_requestFileSystem;l.prototype=l.fn={isSupported:function(){null===b&&(b=!!a&&(!!h.Blob||!!h.BlobBuilder)&&h.FileReader);return b},open:function(c){var e=this,g=e.adapter,k=function(a){c(!1)};c=d(c);b?null===g?(h.requestFileSystem=a,h.requestFileSystem(h.TEMPORARY,e.size,function(a){g=e.adapter=a;try{e.create("test-item",f.jsonToString({test:"test-content"}),function(a){a?e.remove("test-item",function(){c(g)}):c(!1)})}catch(b){c(!1)}},k)):c(g):
c(!1)},create:function(a,e,f){f=d(f);if(a&&b){var k=this.adapter,s=function(a){f(!1,a)};g(k,a,function(){k.root.getFile(a,{create:!0},function(a){a.createWriter(function(a){var c;a.onwriteend=function(){f(!0)};a.onerror=s;try{Blob?(c=new Blob([e],{type:"text/plain"}),a.write(c)):BlobBuilder&&(c=new BlobBuilder,c.append(e),a.write(c.getBlob("application/json")))}catch(b){s(b)}},s)},s)})}else f(!1)},read:function(a,e){e=d(e);if(a&&b){var f=this.adapter,k=function(a){e(!1,a)};g(f,a,function(){f.root.getFile(a,
{create:!1},function(a){a.file(function(a){var c=new FileReader;c.onloadend=function(){e(this.result)};c.onerror=k;c.onabort=k;c.readAsText(a)},k)},k)})}else e(!1)},update:function(a,e,b){this.create(a,e,b)},remove:function(a,e){e=d(e);if(a&&b){var f=this.adapter,k=function(a){e(!1,a)};g(f,a,function(){f.root.getFile(a,{create:!1},function(a){a.remove(function(){e(!0)},k)},k)})}else e(!1)},init:function(a){return this.isSupported()?(a&&a.size&&(this.size=a.size),this):!1}};r.ns("cache.storage.adapter."+
n,l)})(window,window.getNs());
(function(h,r,q){function k(d){if(!(this instanceof k))return new k(d);this.adapter=null;this.type=g;this.dbName="cache";this.dbVersion="1.0";this.dbTable="offline";this.dbDescription="offline cache";this.dbKey="key";this.init(d)}var g="indexedDatabase",l=r.helpers.utils.callback,n=null,f=h.indexedDB||h.webkitIndexedDB||h.mozIndexedDB||h.OIndexedDB||h.msIndexedDB;k.prototype=k.fn={isSupported:function(){null===n&&(n=!!f);return n},create:function(d,b,a){a=l(a);if(d&&n){var c=this.dbTable,e=this.adapter.transaction([c],
"readwrite");d=e.objectStore(c).put({key:d,content:b});e.onerror=function(c){a(!1,c)};d.onerror=function(c){a(!1,c)};d.onsuccess=function(){a(!0)}}else a(!1)},read:function(d,b){b=l(b);if(d&&n){var a=this.dbTable,c=this.adapter.transaction([a],"readonly"),a=c.objectStore(a).get(d);c&&a?(c.onerror=function(a){b(!1,a)},a.onerror=function(a){b(!1,a)},a.onsuccess=function(a){a.target.result&&a.target.result.content?b(a.target.result.content):b(!1)}):b(!1)}else b(!1)},update:function(d,b,a){this.create(d,
b,a)},remove:function(d,b){b=l(b);if(d&&n){var a=this.dbTable,c=this.adapter.transaction([a],"readwrite"),a=c.objectStore(a).put({key:d,content:""});c.onerror=function(a){b(!1,a)};a.onerror=function(a){b(!1,a)};a.onsuccess=function(){b(!0)}}else b(!1)},open:function(d,b){b||(b=!1);d=l(d);var a=this,c=null,e=null,k=null,g=a.dbName,s=a.dbTable,w=function(c){c||d(!1);a.create("test-item",'{test: "test-content"}',function(b){b?a.remove("test-item",function(){d(c)}):d(!1)})},p,m,n,t,u;if(null===a.adapter)if(c=
f){h.webkitIndexedDB!==q&&(h.IDBTransaction=h.webkitIDBTransaction,h.IDBKeyRange=h.webkitIDBKeyRange);p=function(c){c.createIndex(a.dbKey,a.dbKey,{unique:!0});c.createIndex("content","content",{unique:!1})};m=function(c){var b=e.result,f,m;a.adapter=b;a.dbVersion===b.version||!b.setVersion&&"function"!==typeof b.setVersion?(a.adapter=b,w(b)):(k=c.currentTarget.result.setVersion(a.dbVersion),k.onfailure=function(a){d(!1)},k.onsuccess=function(c){f=e.result;try{m=f.createObjectStore(s,{keyPath:a.dbKey}),
p(m)}catch(b){d(!1)}})};n=function(c){c=e.result.createObjectStore(s,{keyPath:a.dbKey});p(c)};t=function(c){b||a.open(d,!0);d(!1)};u=function(a){d(!1)};if(b)try{e=c.open(g,a.dbVersion)}catch(B){e=c.open(g)}else e=c.open(g);e.onsuccess=m;e.onupgradeneeded=n;e.onerror=t;e.onblocked=u}else d(!1);else w(a.adapter)},init:function(d){return this.isSupported()?(d&&(d.name&&(this.dbName=String(d.name)),d.version&&(this.dbVersion=parseInt(d.version,10)),d.table&&(this.dbTable=d.table),d.description&&(this.dbDescription=
String(d.description)),d.key&&(this.dbKey=d.key)),this):!1}};r.ns("cache.storage.adapter."+g,k)})(window,window.getNs());
(function(h,r,q){function k(b,a,c,e,d,f){!f&&b?b.transaction(function(b){b.executeSql(a,c,e,d)}):f?f.executeSql(a,c,e,d):d(null,{code:0,message:l+" isn't available"})}function g(b){if(!(this instanceof g))return new g(b);this.adapter=null;this.type=l;this.dbName="cache";this.dbVersion="1.0";this.dbDescription="resource cache";this.dbTable="websql";this.dbSize=4194304;this.init(b)}var l="webSqlDatabase",n=r.helpers.utils.callback,f=null,d=h.openDatabase;g.prototype=g.fn={isSupported:function(){null===
f&&(f=!!d);return f},create:function(b,a,c){c=n(c);b&&f?k(this.adapter,"INSERT INTO "+this.dbTable+" (key, content) VALUES (?,?);",[b,a],function(){c(!0)},function(a,b){c(!1,b,{transaction:a})}):c(!1)},read:function(b,a){a=n(a);b&&f?k(this.adapter,"SELECT content FROM "+this.dbTable+" WHERE key=?;",[b],function(c,b){var d=!1;b&&(b.rows&&1===b.rows.length)&&(d=b.rows.item(0).content);a(d,null,{transaction:c})},function(c,b){a(!1,b,{transaction:c})}):a(!1)},update:function(b,a,c){c=n(c);b&&f?k(this.adapter,
"UPDATE "+this.dbTable+" SET content = ?  WHERE key=?;",[a,b],function(){c(!0)},function(a,b){c(!1,b,{transaction:a})}):c(!1)},remove:function(b,a){a=n(a);b&&f?k(this.adapter,"DELETE FROM "+this.dbTable+" WHERE key = ?;",[b],function(){a(!0)},function(c,b){a(!1,b,{transaction:c})}):a(!1)},open:function(b){b=n(b);if(f){var a=this,c=a.adapter,e,g=function(c){c||b(!1);e=function(e){e?a.remove("test-item",function(){b(c)}):b(!1)};a.read("test-item",function(c){c?a.update("test-item",'{test: "test-content"}',
e):a.create("test-item",'{test: "test-content"}',e)})},l=function(c,b){k(c,"CREATE TABLE IF NOT EXISTS "+a.dbTable+"(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, key TEXT NOT NULL UNIQUE, content TEXT NOT NULL);",[],function(){g(a.adapter)},function(a){g(!1)},b)},s=function(a){l(null,a)},w=function(a){b(!1)};try{if(null===c&&a.isSupported())if(a.adapter=c=d(a.dbName,"",a.dbDescription,a.dbSize),String(c.version)!==String(a.dbVersion)&&c.changeVersion&&"function"===typeof c.changeVersion)try{c.changeVersion(c.version,
a.dbVersion,s,w)}catch(p){b(!1)}else c=h.openDatabase(a.dbName,a.dbVersion,a.dbDescription,a.dbSize),l(c);else a.isSupported()&&g(c)}catch(m){b(!1)}}else b(!1)},init:function(b){return this.isSupported()?(b&&(b.description&&(this.dbDescription=b.description),b.name&&(this.dbName=b.name),b.size&&(this.dbSize=b.size),b.table&&(this.dbTable=b.table),b.version&&(this.dbVersion=String(b.version))),this):!1}};r.ns("cache.storage.adapter."+l,g)})(window,window.getNs());
(function(h,r,q){function k(a){a=f(a);switch(a){case "local":a="localStorage";break;case "session":a="sessionStorage";break;default:a="localStorage"}return a}function g(a){if(!(this instanceof g))return new g(a);this.adapter=null;this.type=l;this.lifetime="local";this.asynch=!0;this.init(a)}var l="webStorage",n=r.helpers.utils,f=n.trim,d=n.callback,b=null;g.prototype=g.fn={isSupported:function(){var a=k(this.lifetime);if(null===b)try{b=!!h[a]&&!!h[a].getItem}catch(c){b=!1}return b},create:function(a,
c,b){var f=this,g=!0,k=function(a){if(f.asynch)b(a);else return a};b=d(b);if(!a)return k(!1);try{f.adapter.setItem(a,c)}catch(h){g=!g}return k(g)},read:function(a,c){var b=this,f,g=!0,k=function(a){if(b.asynch)c(a);else return a};c=d(c);if(!a)return k(!1);try{g=(f=b.adapter.getItem(a))?f:!1}catch(h){g=!g}return k(g)},update:function(a,c,b){if(this.asynch)this.create(a,c,b);else return this.create(a,c,b)},remove:function(a,c){var b=this,f=!0,g=function(a){if(b.asynch)c(a);else return a};c=d(c);if(!a)return g(!1);
try{b.adapter.removeItem(a)}catch(k){f=!f}return g(f)},open:function(a){var c=this,b=c.adapter,f=k(c.lifetime),g,s,l=function(b){if(c.asynch)a(b);else return b};a=d(a);if(null===b)try{if(b=c.adapter=h[f],c.asynch)c.create("test-item",'{test: "test-content"}',function(d){d?c.remove("test-item",function(){a(b)}):a(!1)});else{if(g=c.create("test-item",'{test: "test-content"}'))if(s=c.remove("test-item"))return b;return!1}}catch(p){return l(!1)}else if(c.isSupported())return l(b)},init:function(a){return this.isSupported()?
(a&&(a.lifetime&&(this.lifetime=f(String(a.lifetime))),a.asynch!==q&&(this.asynch=!!a.asynch)),this):!1}};r.ns("cache.storage.adapter."+l,g)})(window,window.getNs());
(function(h,r,q,k){function g(a,b){b.isLoaded||(b.isLoaded=!0,b.progressCallback(100),h.setTimeout(function(){a()},b.delay))}function l(a){if(!(this instanceof l))return new l(a);this.adapter=null;this.type=n;this.isLoaded=!1;this.delay=0;this.opened=!0;this.message="New version available. Update page?";this.init(a)}var n="applicationCache",f=q.helpers,d=f.utils,b=f.dom,a=d.on,c=d.callback,e=null,y=r.getElementsByTagName("html")[0],z=h.applicationCache;l.prototype=l.fn={isSupported:function(){null===
e&&(e=!!z&&!!b.getAttribute(y,"manifest"));return e},open:function(b,d){var e=this,f=e.adapter,l=0,t,n;e.opened=!0;b=c(b);d&&d.progress&&(t=d.progress);t=e.progressCallback=c(t);if(e.isSupported()&&null!==f){n=function(){try{f.swapCache()}catch(a){}confirm(e.message)?h.location.reload(!0):g(b,e);return!1};a(f,"noupdate",function(){g(b,e);return!1});a(f,"downloading",function(){l=0;return!1});a(f,"progress",function(a){var b=0;e.delay=500;l+=1;b=a&&a.lengthComputable!==k?Math.round(100*a.loaded/a.total):
Math.round(100*l/20);t(b);return!1});a(f,"cached",function(){g(b,e);return!1});a(f,"updateready",function(){n()});a(f,"obsolete",function(){h.location.reload(!0);return!1});a(f,"error",function(){g(b,e);return!1});switch(f.status){case f.UNCACHED:g(b,e);break;case f.IDLE:g(b,e);break;case f.UPDATEREADY:n();break;case f.OBSOLETE:g(b,e)}a(h,"online",function(){try{f.update()}catch(a){}});h.setTimeout(function(){e.isLoaded||g(b,e)},12E3)}else g(b,e)},init:function(a){this.isSupported()&&(null===this.adapter&&
(this.adapter=z),a&&(a.message&&(this.message=String(a.message)),a.delay!==k&&(this.delay=parseInt(a.delay,10))));return this}};q.ns("cache.storage.adapter."+n,l)})(window,document,window.getNs());
(function(h,r,q,k){function g(a,b,c){c.timeout=h.setTimeout(function(){b(!1)},4E3);v(a,function(a){h.clearTimeout(c.timeout);delete c.timeout;a?b(a):b(!1)})}function l(a){var b=null;try{b=s.jsonToObject(a)}catch(c){}return b}function n(a,b,c){if(B){var d=r.createElement("canvas"),e,f=new Image,g=null,m=0,h=0;c||(c="jpeg");f.onerror=function(){f.onload=f.onerror=null;b()};f.onload=function(){f.onload=f.onerror=null;m=d.height=f.height;h=d.width=f.width;e=d.getContext("2d");e.fillStyle="rgba(50, 50, 50, 0)";
e.fillRect(0,0,h,m);e.drawImage(f,0,0);g=d.toDataURL("image/"+c);b(g)};f.src=a;if(f.complete&&f.naturalWidth!==k)f.onload()}else b(!1)}function f(a){var b=a.data,c=a.url;"css"===a.type&&(c=s.url(c),c=c.folder,b=b.replace(/url\(\../g,"url("+c+".."),b=b.replace(/url\(\'../g,"url('"+c+".."),b=b.replace(/url\(\"../g,'url("'+c+".."),a.data=b);return a}function d(a,b){return{ajax:a.ajax,data:a.data,expires:(new Date).getTime()+(a.lifetime||b.lifetime),group:a.group!==k?a.group:b.group,lastmod:a.lastmod||
b.lastmod,lifetime:a.lifetime!==k?a.lifetime:b.lifetime,type:a.type||b.type,version:a.version||b.version}}function b(a){return A&&A[a]?!!A[a]:!1}function a(b,c){var d=null,e,f;b&&b.length?(e=b[0].type,f=b.slice(1),u[e]?d=new u[e](x):a(f,c),d&&d.isSupported()?d.open(function(e){e?(A=b[0],c(d)):a(f,c)}):a(f,c)):c(!1)}function c(b,d,e){var f=null,g=0,k;if(e)try{u[e]?(f=new u[e](x))&&f.isSupported()?f.open(function(a){if(a){k=d.length;for(g=0;g<k;g+=1)d[g].type===e&&(A=d[g]);A?b(f):c(b,d)}else c(b,d)}):
c(b,d):c(b,d)}catch(m){c(b,d)}else a(d,b)}function e(a,b){if(!(this instanceof e))return new e(a,b);this.isEnabled=!0;this.appCacheAdapter=this.adapter=null;this.adapters={types:C,defaults:x};this.resources={defaults:D};this.init(a,b)}var y=q.helpers,z=y.client,s=y.utils,w=s.isArray,p=s.callback,m=s.getJson(),v=s.xhr,t=s.trim,u=q.cache.storage.adapter,B=z.hasCanvas(),C=[{type:"fileSystem",css:!0,js:!0,html:!0,img:!0},{type:"indexedDatabase",css:!0,js:!0,html:!0,img:!0},{type:"webSqlDatabase",css:!0,
js:!0,html:!0,img:!0},{type:"webStorage",css:!0,js:!0,html:!0,img:!0}],x={name:"localcache",table:"cache",description:"local resource cache",size:4194304,version:"1.0",key:"key",lifetime:"local",offline:!0},A=null,D={ajax:!0,lifetime:2E4,group:0,lastmod:(new Date).getTime(),type:"css",version:1};e.prototype=e.fn={create:function(a,c){c=p(c);if(a&&a.url){var e=this,k=a.url,m=a.type,h=function(g){if(g)if(a.data=g,a=f(a),null!==e.adapter&&b(m)){g=s.jsonToString(k);var h=d(a,e.resources.defaults),t=s.jsonToString(h);
a.expires=h.expires;a.version=h.version;try{e.adapter.create(g,t,function(b){b?c(a):c(!1)})}catch(l){c(a)}}else c(a);else c(a)};a.ajax?"img"===m?n(k,h):g(k,h,a):a.data?h(a.data):c(!1)}else c(!1)},read:function(a,c){c=p(c);if(a&&a.url){var d=this,e=a.url,f=a.type;if(null!==this.adapter&&b(f))try{d.adapter.read(s.jsonToString(e),function(b){b?(a=l(b))?(a.url=e,c(a,!0)):d.remove({url:e,type:f},function(){c(!1)}):c(!1)})}catch(k){g(e,function(b){a.data=b;c(a,!0)},a)}else c(a)}else c(!1)},update:function(a,
c){c=p(c);if(a&&a.url){var e=this,k=a.url,h=a.type,m=function(g){if(g)if(a.data=g,a=f(a),null!==e.adapter&&b(h)){g=s.jsonToString(k);var m=d(a,e.resources.defaults),t=s.jsonToString(m);a.expires=m.expires;a.version=m.version;try{e.adapter.update(g,t,function(b){b?c(a):c(!1)})}catch(l){c(a)}}else c(a);else e.read(a,function(b){b&&b.data?(a.data=b.data,c(a)):c(!1)})};a.ajax?"img"===h?n(k,m):g(k,m,a):a.data?m(a.data):c(!1)}else c(!1)},remove:function(a,c){c=p(c);if(a&&a.url){var e=a.url,d=a.type;null!==
this.adapter&&b(d)?this.adapter.remove(s.jsonToString(e),function(b){b?c(a):c(!1)}):c(a)}else c(!1)},init:function(a,b){var e=this,d=!1,f,g,h,l;a=p(a);b&&b.isEnabled!==k&&(e.isEnabled=!!b.isEnabled);if(e.isEnabled&&m){if(b){if(b.adapters){f=b.adapters;if(f.types&&w(f.types)){g=f.types;h=g.length;for(l=0;l<h;l+=1)g[l].css===k&&(g[l].css=!0),g[l].js===k&&(g[l].js=!0),g[l].img===k&&(g[l].img=!0),g[l].html===k&&(g[l].html=!0);e.adapters.types=g}f.defaults&&(g=f.defaults,h=e.adapters.defaults,g.name&&
(h.name=t(String(g.name))),g.table&&(h.table=t(String(g.table))),g.description&&(h.description=t(String(g.description))),g.size&&(h.size=parseInt(g.size,10)),g.version&&(h.version=t(String(g.version))),g.key&&(h.key=t(String(g.key))),g.lifetime&&(h.lifetime=t(String(g.lifetime))),g.offline!==k&&(h.offline=!!g.offline));f.preferredType&&(d=t(String(f.preferredType)))}b.resources&&(f=b.resources,f.defaults&&(f=f.defaults,g=e.resources.defaults,f.ajax!==k&&(g.ajax=!!f.ajax),f.lifetime!==k&&(g.lifetime=
parseInt(f.lifetime,10)),f.group!==k&&(g.group=parseInt(f.group,10)),f.lastmod!==k&&(g.lastmod=parseInt(f.lastmod,10)),f.type&&(g.type=t(String(f.type))),f.group!==k&&(g.version=parseFloat(f.version)),f.loaded&&(g.loaded=p(f.loaded))))}c(function(b){b||(e.isEnabled=!1);e.adapter=b;a(e)},e.adapters.types,d);e.adapters.defaults.offline&&(u.applicationCache&&!e.appCacheAdapter)&&(e.appCacheAdapter=new u.applicationCache(x))}else a(e)}};q.ns("cache.storage.controller",e)})(window,document,window.getNs());
(function(h,r){function q(a){var e=b(a.type);if("js"!==e||"css"!==e||"html"!==e||"img"!==e||"custom"!==e){switch(n.url(a.url).extension){case "js":a="js";break;case "css":a="css";break;case "html":a="html";break;case "jpg":case "jpeg":case "png":a="img";break;default:a="custom"}e=a}return e}function k(a,b){if(!(this instanceof k))return new k(a,b);this.storage=null;this.init(a,b)}var g=h.helpers,l=g.dom,n=g.utils,f=g.client,d=n.isArray,b=n.trim,a=n.callback;k.prototype=k.fn={load:function(c,e){var g=
this,k=(new Date).getTime(),h=function(){var a=0,b=0,c=null;return{init:function(f,e){c=e;a=f;b=0},loaded:function(){b+=1;b===a&&c()}}}(),n=function(a,b,c){var f=a.url,e=function(){a.loaded(a);h.loaded()},d=a.node||null;c=!!c;switch(a.type){case "js":l.appendJs(f,b,e,d,c);break;case "css":l.appendCss(f,b,e,d,c);break;case "img":l.appendImg(f,b,e,d,c);break;case "html":l.appendHtml(f,b,e,d,c);break;default:e()}},p=function(b){var c=b.data||null,e=function(a,b){a&&a.data?n(a,a.data,b):n(a,null,b)},
d=g.storage,h=d.resources.defaults;b.ajax=b.ajax!==r?!!b.ajax:h.ajax;b.loaded=b.loaded!==r?a(b.loaded):a(h.loaded);d.read(b,function(a){if(a&&a.data){var h=b,m=g.storage.resources.defaults,l=parseInt(a.lifetime,10),p=a.version,s=a.lastmod?a.lastmod:0,q=!1,x,v=h.lastmod?h.lastmod:0,q=!0;x=!1;h.version=x=h.version!==r?parseFloat(h.version):m.version;h.group=h.group!==r?parseFloat(h.group):m.group;v&&s?(h.lastmod=parseInt(v,10),q=s===h.lastmod):!v&&s?v=s:v||(v=m.lastmod);q=q&&x===p;x=0!==l&&(-1!==l&&
q&&a.expires>k||-1===l&&q);h.lastmod=v;h.isValid=x;b=h;b.isValid||!f.isOnline()?(c=a.data)&&n(b,c):d.update(b,e)}else d.create(b,e)})},m=function(a,c){var e=0,f=a.length,d=null;h.init(f,c);for(e=0;e<f;e+=1)(d=a[e])&&d.url&&(d.url=b(d.url),d.type=q(d),p(d))},v=function(a,b,c){var e=a.length;for(c||(c=0);!a[c]&&c<e;)c+=1;c>=e?b(g):(e=a[c],m(e,function(){v(a,b,c+1)}))};(function(b,c){b&&d(b)||(b=[]);for(var f=b,g=[],h,k=0,m,l=f.length,k=0;k<l;k+=1)m=f[k],(h=m.group)||(h=0),h=g[h]?g[h]:g[h]=[],h.push(m);
b=g;c=a(e);v(b,c)})(c,e)},remove:function(c,e){var f=this.storage,g=function(a,c){var e=a.length,d,g,h=function(a,b){a===e-1&&c()};if(e)for(d=0;d<e;d+=1)(g=a[d])&&g.url&&(g.url=b(g.url),g.type=q(g),f.remove(g,h(d,g.url)));else c()};(function(b,c){b&&d(b)||(b=[]);c=a(e);g(b,c)})(c,e)},init:function(b,e){var f=this;b=a(b);h.cache.storage.controller(function(a){f.storage=a;b(a)},e);return f}};h.ns("cache.controller",k)})(window.getNs());
(function(h,r,q){function k(a){this.storage=this.controller=null;this.params=a;this.queue=new f;this.timeout=this.interval=this.calls=0}function g(c){var e=null,f=n.length,d;c||(c=z);if(b)for(d=0;d<f;d+=1)a(n[d].params)===a(c)&&(e=n[d]);e||(e=new k(c),n.push(e));return e}function l(a,b,c){var d=g(a),f,k,l,n=function(){f=d.interval;h.clearInterval(f);f=h.setInterval(function(){d.timeout=k=d.timeout+e;l=d.storage;d.controller&&(l&&(l.adapter||!l.isEnabled))&&(h.clearInterval(f),d.queue.flush());k>y&&
(h.clearInterval(f),c())},e)};d?d.storage?b(d):(d.queue.add(function(){b(d)}),d.calls+=1,1===d.calls?d.controller=new r.cache.controller(function(a){d.storage=a;d.controller?d.queue.flush():n()},a):n()):c()}var n=[];q=r.helpers;var f=q.queue;q=q.utils;var d=q.isArray,b=q.getJson(),a=q.jsonToString,c=q.callback,e=15,y=5E3,z={};q=function(){return{load:function(a,b,e){b=c(b);l(e,function(c){d(a)?c.controller.load(a,b):"applicationCache"===a?(c=c.storage)&&c.appCacheAdapter?c.appCacheAdapter.open(b,
e):b(!1):b(!1)},function(){b(!1)});return this},remove:function(a,b,e){b=c(b);l(e,function(c){d(a)?c.controller.remove(a,b):b(!1)},function(){b(!1)});return this},setup:function(a){a&&(z=a);return this}}}();r.ns("cache.load",q.load);r.ns("cache.remove",q.remove);r.ns("cache.setup",q.setup)})(window,window.getNs());
