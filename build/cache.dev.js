(function(a,u){function b(){a[g]||(a[g]={});return a[g]}var g="app",f;f=b();f.namespace=f.ns=function(f,b){if(f){f=String(f);var p=f.split("."),m=p.length,s=a[g],t;s||(a[g]={});if(!p)return!1;for(t=0;t<m;t+=1)s[p[t]]||(s[p[t]]={}),t===m-1&&b!==u&&(s[p[t]]=b),s=s[p[t]];return s}return!1};a[g]=f;a.getNamespace=a.getNs=b})(window);
(function(a,u){function b(){if(!(this instanceof b))return new b;this.methods=[];this.response=null;this.flushed=!1}b.prototype=b.fn={add:function(a){this.flushed?a(this.response):this.methods.push(a)},flush:function(a){if(!this.flushed)for(this.response=a,this.flushed=!0;this.methods[0];)this.methods.shift()(a)}};a.ns("helpers.queue",b)})(window.getNs());
(function(a,u,b,g){var f=function(){var b=null,n=[];return{isString:function(a){return"string"===typeof a||a instanceof String},isFunction:function(a){return"function"===typeof a||a instanceof Function},isArray:function(a){var b=Array.isArray,g=Object.prototype.toString;f.isArray=b&&"function"===typeof b?function(a){return b(a)}:g&&"function"===g?function(a){return"[object Array]"===g.call(a)}:function(a){return!!a.sort&&"function"===typeof a.sort};return f.isArray(a)},inArray:function(a,b,g){f.inArray=
Array.prototype.indexOf?function(a,c,l){return n.indexOf.call(c,a,l)}:function(a,c,l){var e=c.length,d=0;if(l)return c[l]&&c[l]===a?l:-1;for(d=0;d<e;d+=1)if(c[d]===a)return d;return-1};return f.inArray(a,b,g)},callback:function(a){f.isFunction(a)||(a=function(){return g});return a},on:function(b,g,s){f.on="function"===typeof a.addEventListener?function(a,c,l){a.addEventListener(c,l,!1)}:"function"===typeof u.attachEvent?function(a,c,l){a.attachEvent("on"+c,l)}:function(a,c,l){a["on"+c]=l};f.on(b,
g,s)},off:function(b,g,s){f.off="function"===typeof a.removeEventListener?function(a,c,l){a.removeEventListener(c,l,!1)}:"function"===typeof u.detachEvent?function(a,c,l){a.detachEvent("on"+c,l)}:function(a,c){a["on"+c]=null};f.off(b,g,s)},getXhr:function(){for(var a=null,b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],f=b.length,g=0,g=0;g<
f;g+=1){try{a=b[g]()}catch(c){continue}break}return a},xhr:function(a,b,s,n){var c=f.getXhr(),l,e="GET";b=f.callback(b);if(c)if(a){n!==g?e="POST":n=null;s===g&&(s=!0);l=function(){if(4===c.readyState&&(200<=c.status&&400>c.status||0===c.status))try{var d=c.responseText;d?b(d):b(!1)}catch(e){b(!1)}else 4===c.readyState&&b(!1)};c.open(e,a,s);try{c.onreadystatechange!==g?c.onreadystatechange=l:c.onload!==g&&(c.onload=l)}catch(d){c.onload=null,c.onload=l}c.send(n)}else b(!1);else b(!1)},getJson:function(){null===
b&&(a.JSON&&a.JSON.stringify)&&(b=a.JSON);return b},jsonToString:function(a){var m=!1;null===b&&(b=f.getJson());b&&a!==g&&(m=b.stringify(a));return m},jsonToObject:function(a){var m=!1;null===b&&(b=f.getJson());b&&a!==g&&(m=b.parse(a));return m},logToScreen:function(a){var b=u.getElementById("log"),g=u.createElement("p");a=u.createTextNode(a);b&&(g.appendChild(a),b.appendChild(g))},log:function(){var b=arguments,m=a.console!==g,n=m?a.console:null,m=m&&n.log!==g;b.length&&(m&&n.log.apply(n,b),b=b[0],
f.logToScreen(b))},url:function(a){if(f.isString(a)){var b=u.createElement("a"),g;b.href=a;g=b.pathname.match(/\/([^\/?#]+)$/i);return{source:a,protocol:b.protocol,host:b.hostname,port:b.port,query:b.search,file:g?g[1]:"/",hash:b.hash,path:b.pathname.replace(/^([^\/])/,"/$1"),extension:function(a){a=a.split(".");return a.length?a[a.length-1]:!1}(a),folder:function(){var b=a.lastIndexOf("/");return a.substr(0,b+1)}()}}},trim:function(a){if(!f.isString(a))return a;f.isFunction(String.prototype.trim)||
(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});return a.trim()}}}();b.ns("helpers.utils",f)})(window,document,window.getNs());
(function(a,u,b,g){var f=function(){function f(){m===g&&(c(a,"online",f),c(a,"offline",f));m=u.onLine!==g?!!u.onLine:!0}var n,p,m,s,t=(u.userAgent||u.vendor||a.opera).toLowerCase(),c=b.helpers.utils.on;return{isMsie:function(){p===g&&(p=null!==t.match(/(msie)/));return p},isOpera:function(){n===g&&(n=null!==t.match(/(opera)/));return n},isOnline:function(){m===g&&f();return m},hasCanvas:function(){if(s===g){var a=document.createElement("canvas");s=!(!a.getContext||!a.getContext("2d"))}return s}}}();
b.ns("helpers.client",f)})(window,window.navigator,window.getNs());
(function(a,u,b){function g(b,g){g&&(g.dom?b=g.dom:g.id&&(b=a.getElementById(g.id)));return b}var f=function(){var q=u.helpers,n=q.utils,p=q.client,m=[],s=[],t=[],c=[],l=a.getElementsByTagName("head")[0];return{nuke:function(){m=[];s=[];t=[];c=[]},createDomNode:function(e,d){var h=a.createElement(e),k;if(d)for(k in d)d.hasOwnProperty(k)&&h.setAttribute(k,d[k]);return h},getAttribute:function(a,d){return a.getAttribute(d)},setAttribute:function(a,d,h){a.setAttribute(d,h)},appendCss:function(e,d,h,
k,b){if(-1===n.inArray(e,m)||b){var c=null,r=!1,D,s,c=g(c,k);if(null!==d){c||(c=f.createDomNode("style",{type:"text/css"}),c.className="lazyloaded");c.onerror=function(){h(!1)};k||l.appendChild(c);try{D=a.createTextNode(d),c.appendChild(D)}catch(q){c.styleSheet.cssText=d}finally{h(!0)}}else null!==e&&(c||(c=f.createDomNode("link",{rel:"stylesheet",type:"text/css"}),c.className="lazyloaded"),c.onerror=c.error=function(){c.onload=c.load=null;r=!0;window.clearTimeout(s);h(!1)},k||l.appendChild(c),p.isMsie()||
p.isOpera()?c.onload=c.load=function(){c.onerror=c.error=null;r=!0;window.clearTimeout(s);h(!0)}:h(!0),c.href=e,s=window.setTimeout(function(){r||h(!1)},4E3));m.push(e)}else h(!0)},appendJs:function(e,d,h,k,b){if(-1===n.inArray(e,s)||b){b=f.createDomNode("script");var c=a.getElementsByTagName("script")[0],r=!1,m=!1,p;(b=g(b,k))?(b.type="text/javascript",b.className="lazyloaded",b.async=!0,b.onreadystatechange=b.onload=function(){m||this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||
(this.onreadystatechange=this.onload=null,r=m=!0,window.clearTimeout(p),s.push(e),h(!0))},b.onerror=function(){this.onload=this.onreadystatechange=this.onerror=null;window.clearTimeout(p);r=!0;h(!1)},k||(c?c.parentNode.insertBefore(b,c):l.appendChild(b)),d&&!m?(b.textContent?b.textContent=d:b.nodeValue?b.nodeValue=d:b.text=d,r=m=!0):null!==e&&(b.src=e),m&&(s.push(e),r=!0,h(!0)),r||(p=window.setTimeout(function(){m||h(!1)},5E3))):h(!1)}else h(!0)},appendImg:function(a,d,h,k){var c=null;(c=g(c,k))||
(c=new Image);c.onerror=function(){c.onload=c.onerror=null;h(!1)};c.onload=function(){c.onload=c.onerror=null;h(!0)};d?c.src=d:a&&(c.src=a);if(c.complete&&c.naturalWidth!==b)c.onload();t.push(a)},appendHtml:function(e,d,b,k){var l=g(null,k);if(l){if(d)try{l.innerHTML=d,k.id&&p.isMsie()&&a.styleSheets[0].addRule("#"+k.id+":after",'content: " ";')}catch(f){l.innerText=d}b(!0);c.push(e)}else b(!1)}}}();u.ns("helpers.dom",f)})(document,window.getNs());
(function(a,u){function b(a){t("["+p+" Adapter] "+a)}function g(a){if(a){var d=a.name||a.code,c=a.message||a.description||"",k=c;if(FileError)switch(d){case FileError.ENCODING_ERR:case "EncodingError":k="Error Event: ENCODING_ERR "+c;break;case FileError.INVALID_MODIFICATION_ERR:case "InvalidModificationError":k="Error Event: INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:case "InvalidStateError":k="Error Event: INVALID_STATE_ERR "+c;break;case FileError.NO_MODIFICATION_ALLOWED_ERR:case "NoModificationAllowedError":k=
"Error Event: NO_MODIFICATION_ALLOWED_ERR "+c;break;case FileError.NOT_FOUND_ERR:case "NotFoundError":k="Error Event: NOT_FOUND_ERR "+c;break;case FileError.NOT_READABLE_ERR:case "NotReadableError":k="Error Event: NOT_READABLE_ERR "+c;break;case FileError.PATH_EXISTS_ERR:case "PathExistsError":k="Error Event: PATH_EXISTS_ERR "+c;break;case FileError.QUOTA_EXCEEDED_ERR:case "QuotaExceededError":k="Error Event: QUOTA_EXCEEDED_ERR "+c;break;case FileError.SECURITY_ERR:case "SecurityError":k="Error Event: SECURITY_ERR "+
c;break;case FileError.TYPE_MISMATCH_ERR:case "TypeMismatchError":k="Error Event: TYPE_MISMATCH_ERR "+c;break;default:k="Error Event: Unknown Error "+c}else k="Error Event: Unknown Error, no FileError available";b(k,a)}}function f(a,d,c){var k=function(a){g(a);c(!1)};if("."===d[0]||""===d[0])d=d.slice(1);d[0]?a.getDirectory(d[0],{create:!0},function(a){d.length?f(a,d.slice(1),c):c(!0)},k):c(!0)}function q(a,d,b){d=d.split("/");var k=d.length,l="",g=0;b=c(b);if(k){for(g=0;g<k-1;g+=1)l=l+d[g]+"/";f(a.root,
l.split("/"),b)}else b(!0)}function n(a){if(!(this instanceof n))return new n(a);this.adapter=null;this.type=p;this.size=52428800;this.init(a)}var p="fileSystem",m=a.getNs&&a.getNs()||a,s=m.helpers.utils,t=s.log,c=s.callback,l=null;n.prototype=n.fn={isSupported:function(){null===l&&((l=(!!a.requestFileSystem||!!a.webkitRequestFileSystem||!!a.moz_requestFileSystem)&&(!!a.Blob||!!a.BlobBuilder)&&a.FileReader)||b(p+" is not supported"));return l},open:function(e){var d=this,h=d.adapter,k=function(a){g(a);
e(!1)};e=c(e);l?null===h?(a.requestFileSystem=a.requestFileSystem||a.webkitRequestFileSystem||a.moz_requestFileSystem,a.requestFileSystem(a.TEMPORARY,d.size,function(a){h=d.adapter=a;b("Try to create test resource");try{d.create("test-item",s.jsonToString({test:"test-content"}),function(a){a?d.remove("test-item",function(){b("Test resource created and successfully deleted");e(h)}):k()})}catch(c){k(c)}},k)):(b("Adapter already opened"),e(h)):e(!1)},create:function(a,d,h){h=c(h);if(a&&l){var k=this.adapter,
f=function(a){g(a);h(!1,a)};q(k,a,function(){k.root.getFile(a,{create:!0},function(c){c.createWriter(function(c){var k;c.onwriteend=function(){b("File successfully written: url "+a);h(!0)};c.onerror=f;try{Blob?(k=new Blob([d],{type:"text/plain"}),c.write(k)):BlobBuilder&&(k=new BlobBuilder,k.append(d),c.write(k.getBlob("application/json")))}catch(l){f(l)}},f)},f)})}else h(!1)},read:function(a,d){d=c(d);if(a&&l){var b=this.adapter,k=function(a){g(a);d(!1,a)};q(b,a,function(){b.root.getFile(a,{create:!1},
function(a){a.file(function(a){var c=new FileReader;c.onloadend=function(){d(this.result)};c.onerror=k;c.onabort=k;c.readAsText(a)},k)},k)})}else d(!1)},update:function(a,d,c){this.create(a,d,c)},remove:function(a,d){d=c(d);if(a&&l){var b=this.adapter,k=function(a){g(a);d(!1,a)};q(b,a,function(){b.root.getFile(a,{create:!1},function(a){a.remove(function(){d(!0)},k)},k)})}else d(!1)},init:function(a){return this.isSupported()?(a&&a.size&&(this.size=a.size),this):!1}};s.isFunction(m.ns)?m.ns("cache.storage.adapter."+
p,n):m[p]=n})(window);
(function(a,u){function b(a){m("["+q+" Adapter] "+a)}function g(a){a&&b("Database error: "+(a.message||" No message avaible"))}function f(a){if(!(this instanceof f))return new f(a);this.adapter=null;this.type=q;this.dbName="cache";this.dbVersion="1.0";this.dbTable="offline";this.dbDescription="offline cache";this.dbKey="key";this.init(a)}var q="indexedDatabase",n=a.getNs&&a.getNs()||a,p=n.helpers.utils,m=p.log,s=p.callback,t=null;f.prototype=f.fn={isSupported:function(){null===t&&((t=!!a.indexedDB||
!!a.webkitIndexedDB||!!a.mozIndexedDB||!!a.OIndexedDB||!!a.msIndexedDB)||b(q+" is not supported"));return t},create:function(a,l,e){e=s(e);if(a&&t){var d=this.dbTable,h=this.dbName,k=this.adapter.transaction([d],"readwrite");a=k.objectStore(d).put({key:a,content:l});k.onerror=function(a){b("Failed to init transaction while creating/updating database entry "+h+" "+a);g(a);e(!1,a)};a.onerror=function(a){b("Failed to create/update database entry "+h+" "+a);g(a);e(!1,a)};a.onsuccess=function(){e(!0)}}else e(!1)},
read:function(a,l){l=s(l);if(a&&t){var e=this.dbTable,d=this.dbName,h=this.adapter.transaction([e],"readonly"),e=h.objectStore(e).get(a);h&&e?(h.onerror=function(a){b("Failed to init transaction while reading database "+d+" "+a);g(a);l(!1,a)},e.onerror=function(a){b("Failed to read database entry "+d+" "+a);g(a);l(!1,a)},e.onsuccess=function(a){a.target.result&&a.target.result.content?l(a.target.result.content):l(!1)}):l(!1)}else l(!1)},update:function(a,b,e){this.create(a,b,e)},remove:function(a,
l){l=s(l);if(a&&t){var e=this.dbTable,d=this.dbName,h=this.adapter.transaction([e],"readwrite"),e=h.objectStore(e).put({key:a,content:""});h.onerror=function(a){b("Failed to init transaction while deleting database entry "+d+" "+a);g(a);l(!1,a)};e.onerror=function(a){b("Failed to delete database entry "+d+" "+a);g(a);l(!1,a)};e.onsuccess=function(){l(!0)}}else l(!1)},open:function(c,l){l||(l=!1);c=s(c);var e=this,d=null,h=null,k=null,f=e.dbName,v=e.dbTable,r=function(a){a||c(!1);b("Try to create test resource");
e.create("test-item",'{test: "test-content"}',function(d){d?e.remove("test-item",function(){b("Test resource created and successfully deleted");c(a)}):c(!1)})},m,n,p,x,q;if(null===e.adapter)if(d=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.OIndexedDB||a.msIndexedDB){a.webkitIndexedDB!==u&&(a.IDBTransaction=a.webkitIDBTransaction,a.IDBKeyRange=a.webkitIDBKeyRange);m=function(a){a.createIndex(e.dbKey,e.dbKey,{unique:!0});a.createIndex("content","content",{unique:!1})};n=function(a){var d=h.result,
l,x;e.adapter=d;b("Database successfully opened");e.dbVersion===d.version||!d.setVersion&&"function"!==typeof d.setVersion?(e.adapter=d,r(d)):(k=a.currentTarget.result.setVersion(e.dbVersion),k.onfailure=function(a){b("Failed to open database: "+f+" "+a);g(a);c(!1)},k.onsuccess=function(a){l=h.result;x=l.createObjectStore(v,{keyPath:e.dbKey});b("Database needs upgrade: "+f+" "+a.oldVersion+" "+a.newVersion);m(x)})};p=function(a){var d=h.result.createObjectStore(v,{keyPath:e.dbKey});b("Database needs upgrade: "+
f+" "+a.oldVersion+" "+a.newVersion);m(d)};x=function(a){b("Failed to open database: "+f+" "+a);g(a);l||e.open(c,!0);c(!1)};q=function(a){b("Opening database request is blocked! "+f+" "+a);g(a);c(!1)};if(l)try{h=d.open(f,e.dbVersion)}catch(t){b("Could not set version"),g(t),h=d.open(f)}else h=d.open(f);h.onsuccess=n;h.onupgradeneeded=p;h.onerror=x;h.onblocked=q}else c(!1);else r(e.adapter)},init:function(a){return this.isSupported()?(a&&(a.name&&(this.dbName=String(a.name)),a.version&&(this.dbVersion=
parseInt(a.version,10)),a.table&&(this.dbTable=a.table),a.description&&(this.dbDescription=String(a.description)),a.key&&(this.dbKey=a.key)),this):!1}};p.isFunction(n.ns)?n.ns("cache.storage.adapter."+q,f):n[q]=f})(window);
(function(a,u){function b(a){s("["+n+" Adapter] "+a)}function g(a,b,d,c,k,g){!g&&a?a.transaction(function(a){a.executeSql(b,d,c,k)}):g?g.executeSql(b,d,c,k):k(null,{code:0,message:n+" isn't available"})}function f(a){var c="Errorcode: "+(a.code||"Code not present")+", Message: "+(a.message||"Message not present");a.info&&(c=c+" - "+a.info);b(c)}function q(a){if(!(this instanceof q))return new q(a);this.adapter=null;this.type=n;this.dbName="cache";this.dbVersion="1.0";this.dbDescription="resource cache";
this.dbTable="websql";this.dbSize=4194304;this.init(a)}var n="webSqlDatabase",p=a.getNs&&a.getNs()||a,m=p.helpers.utils,s=m.log,t=m.callback,c=null;q.prototype=q.fn={isSupported:function(){null===c&&((c=!!a.openDatabase)||b(n+" is not supported"));return c},create:function(a,b,d){d=t(d);a&&c?g(this.adapter,"INSERT INTO "+this.dbTable+" (key, content) VALUES (?,?);",[a,b],function(){d(!0)},function(a,b){f(b);d(!1,b,{transaction:a})}):d(!1)},read:function(a,b){b=t(b);a&&c?g(this.adapter,"SELECT content FROM "+
this.dbTable+" WHERE key=?;",[a],function(a,c){var k=!1;c&&(c.rows&&1===c.rows.length)&&(k=c.rows.item(0).content);b(k,null,{transaction:a})},function(a,c){f(c);b(!1,c,{transaction:a})}):b(!1)},update:function(a,b,d){d=t(d);a&&c?g(this.adapter,"UPDATE "+this.dbTable+" SET content = ?  WHERE key=?;",[b,a],function(){d(!0)},function(a,b){f(b);d(!1,b,{transaction:a})}):d(!1)},remove:function(a,b){b=t(b);a&&c?g(this.adapter,"DELETE FROM "+this.dbTable+" WHERE key = ?;",[a],function(){b(!0)},function(a,
c){f(c);b(!1,c,{transaction:a})}):b(!1)},open:function(l){l=t(l);if(c){var e=this,d=e.adapter,h,k=function(a){a||l(!1);b("Try to create test resource");h=function(d){d?e.remove("test-item",function(){b("Test resource created and successfully deleted");l(a)}):l(!1)};e.read("test-item",function(a){a?e.update("test-item",'{test: "test-content"}',h):e.create("test-item",'{test: "test-content"}',h)})},m=function(a,d){b("Checking database table: name "+e.dbTable);g(a,"CREATE TABLE IF NOT EXISTS "+e.dbTable+
"(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, key TEXT NOT NULL UNIQUE, content TEXT NOT NULL);",[],function(){k(e.adapter)},function(a){f(a);k(!1)},d)},v=function(a){m(null,a)},r=function(a){a.info="Can't migrate to new database version. This may be caused by non-standard implementation of the changeVersion method. Please switch back your database version to use webSql on this device.";f(a);l(!1)};try{if(null===d&&e.isSupported())if(b("Initializing database"),e.adapter=d=a.openDatabase(e.dbName,
"",e.dbDescription,e.dbSize),String(d.version)!==String(e.dbVersion)&&d.changeVersion&&"function"===typeof d.changeVersion){b("Try to update version: new version "+d.version+", old version "+e.dbVersion);try{d.changeVersion(d.version,e.dbVersion,v,r)}catch(n){f(n),l(!1)}}else b("Open database with version number: "+e.dbVersion),d=a.openDatabase(e.dbName,e.dbVersion,e.dbDescription,e.dbSize),m(d);else e.isSupported()&&(b("database already initialized"),k(d))}catch(p){f(p),l(!1)}}else l(!1)},init:function(a){return this.isSupported()?
(a&&(a.description&&(this.dbDescription=a.description),a.name&&(this.dbName=a.name),a.size&&(this.dbSize=a.size),a.table&&(this.dbTable=a.table),a.version&&(this.dbVersion=String(a.version))),this):!1}};m.isFunction(p.ns)?p.ns("cache.storage.adapter."+n,q):p[n]=q})(window);
(function(a,u){function b(a){t("["+n+" Adapter] "+a)}function g(d){!d&&a.event&&(d=a.event);b("Event - key: "+(d.key||"no e.key event")+", url: "+(d.url||"no e.url event"))}function f(a){a=c(a);switch(a){case "local":a="localStorage";break;case "session":a="sessionStorage";break;default:a="localStorage"}return a}function q(a){if(!(this instanceof q))return new q(a);this.adapter=null;this.type=n;this.lifetime="local";this.asynch=!0;this.init(a)}var n="webStorage",p=a.getNs&&a.getNs()||a,m=p.helpers.utils,
s=m.on,t=m.log,c=m.trim,l=m.callback,e=null;q.prototype=q.fn={isSupported:function(){var d=f(this.lifetime);if(null===e)try{e=!!a[d]&&!!a[d].getItem}catch(c){b(n+" is not supported",c),e=!1}return e},create:function(a,b,c){var f=this,e=!0,r=function(a){if(f.asynch)c(a);else return a};c=l(c);if(!a)return r(!1);try{f.adapter.setItem(a,b)}catch(m){e=!e,g(m)}return r(e)},read:function(a,b){var c=this,f,e=!0,r=function(a){if(c.asynch)b(a);else return a};b=l(b);if(!a)return r(!1);try{e=(f=c.adapter.getItem(a))?
f:!1}catch(m){e=!e,g(m)}return r(e)},update:function(a,b,c){if(this.asynch)this.create(a,b,c);else return this.create(a,b,c)},remove:function(a,b){var c=this,f=!0,e=function(a){if(c.asynch)b(a);else return a};b=l(b);if(!a)return e(!1);try{c.adapter.removeItem(a)}catch(r){f=!f,g(r)}return e(f)},open:function(c){var e=this,k=e.adapter,m=f(e.lifetime),n,r,p=function(a){if(e.asynch)c(a);else return a};c=l(c);if(null===k)try{if(k=e.adapter=a[m],s(a,"storage",g),b("Lifetime used: "+m),b("Try to create test resource"),
e.asynch)e.create("test-item",'{test: "test-content"}',function(a){a?e.remove("test-item",function(){b("Test resource created and successfully deleted");c(k)}):c(!1)});else{if(n=e.create("test-item",'{test: "test-content"}'))if(r=e.remove("test-item"))return b("Test resource created and successfully deleted"),k;return!1}}catch(q){return g(q),p(!1)}else if(e.isSupported())return p(k)},init:function(a){return this.isSupported()?(a&&(a.lifetime&&(this.lifetime=c(String(a.lifetime))),a.asynch!==u&&(this.asynch=
!!a.asynch)),this):!1}};m.isFunction(p.ns)?p.ns("cache.storage.adapter."+n,q):p[n]=q})(window);
(function(a,u,b){function g(a){l("["+n+" Adapter] "+a)}function f(b,c){c.isLoaded||(c.isLoaded=!0,c.progressCallback(100),a.setTimeout(function(){b();g("Event loaded")},c.delay))}function q(a){if(!(this instanceof q))return new q(a);this.adapter=null;this.type=n;this.isLoaded=!1;this.delay=0;this.opened=!0;this.message="New version is available. Update page?";this.init(a)}var n="applicationCache",p=a.getNs&&a.getNs()||a,m=p.helpers,s=m.utils,t=m.dom,c=s.on,l=s.log,e=s.callback,d=null,h=u.getElementsByTagName("html")[0];
q.prototype=q.fn={isSupported:function(){null===d&&((d=!!a.applicationCache&&!!t.getAttribute(h,"manifest"))||g(n+" is not supported or there is no manifest html attribute"));return d},open:function(d,l){var h=this,r=h.adapter,m=0,n,p;h.opened=!0;d=e(d);l&&l.progress&&(n=l.progress);n=h.progressCallback=e(n);if(h.isSupported()&&null!==r){p=function(){g("Event updateready");try{r.swapCache()}catch(b){g("Event updateready: swapcache is not available",b)}confirm(h.message)?a.location.reload(!0):f(d,
h);return!1};c(r,"checking",function(){g("Event checking");return!1});c(r,"noupdate",function(){g("Event noupdate");f(d,h);return!1});c(r,"downloading",function(){g("Event downloading");m=0;return!1});c(r,"progress",function(a){g("Event progress");var c=0;h.delay=500;m+=1;c=a&&a.lengthComputable!==b?Math.round(100*a.loaded/a.total):Math.round(100*m/20);n(c);return!1});c(r,"cached",function(){g("Event cached");f(d,h);return!1});c(r,"updateready",function(){p()});c(r,"obsolete",function(){g("Event obsolete");
a.location.reload(!0);return!1});c(r,"error",function(){g("Event error");f(d,h);return!1});switch(r.status){case r.UNCACHED:f(d,h);break;case r.IDLE:f(d,h);break;case r.UPDATEREADY:p();break;case r.OBSOLETE:f(d,h)}c(a,"online",function(){try{r.update()}catch(a){g("Window event online: update cache is not available",a)}});a.setTimeout(function(){h.isLoaded||f(d,h)},12E3)}else f(d,h)},init:function(b){var c=this.adapter;this.isSupported()&&(null===c&&(this.adapter=a.applicationCache),b&&b.message&&
(this.message=String(b.message)));return this}};p.ns("cache.storage.adapter."+n,q)})(window,document);
(function(a,u,b,g){function f(a){D("["+h+" controller] "+a)}function q(a){var b="";a&&(b="Error Event: Description "+(a.description||"no description available"));f(b)}function n(b,c,d){d.timeout=a.setTimeout(function(){c(!1)},4E3);x(b,function(b){a.clearTimeout(d.timeout);delete d.timeout;b?c(b):c(!1)})}function p(a){var b=null;try{b=v.jsonToObject(a)}catch(c){q(c),f("Couldn't convert json string to object.")}return b}function m(a,b,c){if(G){var d=u.createElement("canvas"),e,f=new Image,k=null,l=
0,h=0;c||(c="jpeg");f.onerror=function(){f.onload=f.onerror=null;b()};f.onload=function(){f.onload=f.onerror=null;l=d.height=f.height;h=d.width=f.width;e=d.getContext("2d");e.fillStyle="rgba(50, 50, 50, 0)";e.fillRect(0,0,h,l);e.drawImage(f,0,0);k=d.toDataURL("image/"+c);b(k)};f.src=a;if(f.complete&&f.naturalWidth!==g)f.onload()}else b(!1)}function s(a){var b=a.data,c=a.url;"css"===a.type&&(c=v.url(c),c=c.folder,b=b.replace(/url\(\../g,"url("+c+".."),b=b.replace(/url\(\'../g,"url('"+c+".."),b=b.replace(/url\(\"../g,
'url("'+c+".."),a.data=b);return a}function t(a,b){return{ajax:a.ajax,data:a.data,expires:(new Date).getTime()+(a.lifetime||b.lifetime),group:a.group!==g?a.group:b.group,lastmod:a.lastmod||b.lastmod,lifetime:a.lifetime!==g?a.lifetime:b.lifetime,type:a.type||b.type,version:a.version||b.version}}function c(a){return z&&z[a]?!!z[a]:!1}function l(a,b){var c=null,d,e;a&&a.length?(d=a[0].type,e=a.slice(1),f("Testing for storage adapter type: "+d),A[d]?c=new A[d](E):l(e,b),c&&c.isSupported()?c.open(function(g){g?
(C=d,z=a[0],f("Used storage adapter type: "+C),b(c)):l(e,b)}):l(e,b)):b(!1)}function e(a,b,c){var d=null,g=0,k;if(c)try{f("Testing for preferred storage adapter type: "+c),A[c]?(d=new A[c](E))&&d.isSupported()?d.open(function(h){if(h){C=c;k=b.length;for(g=0;g<k;g+=1)b[g].type===c&&(z=b[g]);z?(f("Used storage type: "+C),a(d)):(f("Storage config not found: "+C),e(a,b))}else e(a,b)}):e(a,b):e(a,b)}catch(h){q(h),f("Storage adapter could not be initialized: type "+c),e(a,b)}else l(b,a)}function d(a,b){if(!(this instanceof
d))return new d(a,b);this.isEnabled=!0;this.appCacheAdapter=this.adapter=null;this.adapters={types:H,defaults:E};this.resources={defaults:I};this.init(a,b)}var h="storage",k=b.helpers,F=k.client,v=k.utils,r=v.isArray,D=v.log,y=v.callback,B=v.getJson(),x=v.xhr,w=v.trim,A=b.cache.storage.adapter,G=F.hasCanvas(),H=[{type:"fileSystem",css:!0,js:!0,html:!0,img:!0},{type:"indexedDatabase",css:!0,js:!0,html:!0,img:!0},{type:"webSqlDatabase",css:!0,js:!0,html:!0,img:!0},{type:"webStorage",css:!0,js:!0,html:!0,
img:!0}],E={name:"localcache",table:"cache",description:"local resource cache",size:4194304,version:"1.0",key:"key",lifetime:"local",offline:!0},C=null,z=null,I={ajax:!0,lifetime:2E4,group:0,lastmod:(new Date).getTime(),type:"css",version:1};d.prototype=d.fn={create:function(a,b){b=y(b);if(a&&a.url){var d=this,e=a.url,g=a.type,k=function(k){if(k)if(a.data=k,a=s(a),null!==d.adapter&&c(g)){k=v.jsonToString(e);var h=t(a,d.resources.defaults),l=v.jsonToString(h);a.expires=h.expires;a.version=h.version;
try{d.adapter.create(k,l,function(c){c?(f("Create new resource in storage adapter: type "+g+", url "+e),b(a)):(f("Create new resource in storage adapter failed"),b(!1))})}catch(r){q(r),f("Create new resource in storage adapter failed"),b(a)}}else f("Trying to create new resource, but resource type is not cachable or storage adapter is not available: type "+g+", url "+e),b(a);else f("Couldn't get data via network"),b(a)};a.ajax?"img"===g?m(e,k):n(e,k,a):a.data?k(a.data):b(!1)}else b(!1)},read:function(a,
b){b=y(b);if(a&&a.url){var d=this,e=a.url,g=a.type;if(null!==this.adapter&&c(g)){f("Trying to read resource from storage: type "+g+", url "+e);try{d.adapter.read(v.jsonToString(e),function(c){c?(a=p(c))?(a.url=e,f("Successfully read resource from storage: type "+g+", url "+e),b(a,!0)):d.remove({url:e,type:g},function(){b(!1)}):(f("There is no data coming back from storage while reading: type "+g+", url "+e),b(!1))})}catch(k){q(k),f("Try to read resource from storage, but storage adapter is not available: type "+
g+", url "+e),n(e,function(c){f("Data loaded via ajax: type "+g+", url "+e+", data status "+!!c);a.data=c;b(a,!0)},a)}}else b(a)}else b(!1)},update:function(a,b){b=y(b);if(a&&a.url){var d=this,e=a.url,g=a.type,k=function(k){if(k)if(a.data=k,a=s(a),null!==d.adapter&&c(g)){k=v.jsonToString(e);var h=t(a,d.resources.defaults),l=v.jsonToString(h);a.expires=h.expires;a.version=h.version;try{d.adapter.update(k,l,function(c){c?(f("Updated existing resource in storage adapter: type "+g+", url "+e),b(a)):(f("Updating resource in storage failed."),
b(!1))})}catch(r){q(r),f("Updating resource in storage failed."),b(a)}}else f("Resource type is not cachable or storage adapter is not available: type "+g+", url "+e),b(a);else f("Couldn't get data via network, trying to used stored version"),d.read(a,function(c){c&&c.data?(a.data=c.data,b(a)):b(!1)})};a.ajax?"img"===g?m(e,k):n(e,k,a):a.data?k(a.data):b(!1)}else b(!1)},remove:function(a,b){b=y(b);if(a&&a.url){var d=a.url,e=a.type;null!==this.adapter&&c(e)?this.adapter.remove(v.jsonToString(d),function(c){c?
(f("Delete resource form storage: type "+e+", url "+d),b(a)):(f("Deleting resource form storage failed: type "+e+", url "+d),b(!1))}):(f("Delete resource from storage failed, resource type is not cachable or there is no storage adapter: type "+e+", url "+d),b(a))}else b(!1)},init:function(a,b){var c=this,d=!1,k,h,l,m;a=y(a);b&&b.isEnabled!==g&&(c.isEnabled=!!b.isEnabled);if(c.isEnabled&&B){if(b){if(b.adapters){k=b.adapters;if(k.types&&r(k.types)){h=k.types;l=h.length;for(m=0;m<l;m+=1)h[m].css===g&&
(h[m].css=!0),h[m].js===g&&(h[m].js=!0),h[m].img===g&&(h[m].img=!0),h[m].html===g&&(h[m].html=!0);c.adapters.types=h}k.defaults&&(h=k.defaults,l=c.adapters.defaults,h.name&&(l.name=w(String(h.name))),h.table&&(l.table=w(String(h.table))),h.description&&(l.description=w(String(h.description))),h.size&&(l.size=parseInt(h.size,10)),h.version&&(l.version=w(String(h.version))),h.key&&(l.key=w(String(h.key))),h.lifetime&&(l.lifetime=w(String(h.lifetime))),h.offline!==g&&(l.offline=!!h.offline));k.preferredType&&
(d=w(String(k.preferredType)))}b.resources&&(k=b.resources,k.defaults&&(k=k.defaults,h=c.resources.defaults,k.ajax!==g&&(h.ajax=!!k.ajax),k.lifetime!==g&&(h.lifetime=parseInt(k.lifetime,10)),k.group!==g&&(h.group=parseInt(k.group,10)),k.lastmod!==g&&(h.lastmod=parseInt(k.lastmod,10)),k.type&&(h.type=w(String(k.type))),k.group!==g&&(h.version=parseFloat(k.version)),k.loaded&&(h.loaded=y(k.loaded))))}e(function(b){c.adapter=b;a(c)},c.adapters.types,d);c.adapters.defaults.offline&&(A.applicationCache&&
!c.appCacheAdapter)&&(c.appCacheAdapter=new A.applicationCache(E))}else B||f("There is no json support"),c.isEnabled||f("Caching data is disabled"),a(c)}};b.ns("cache."+h+".controller",d)})(window,document,window.getNs());
(function(a,u){function b(a){t("["+q+" controller] "+a)}function g(a){var b=l(a.type);if("js"!==b||"css"!==b||"html"!==b||"img"!==b||"custom"!==b){switch(m.url(a.url).extension){case "js":a="js";break;case "css":a="css";break;case "html":a="html";break;case "jpg":case "jpeg":case "png":a="img";break;default:a="custom"}b=a}return b}function f(a,b){if(!(this instanceof f))return new f(a,b);this.storage=null;this.init(a,b)}var q="cache",n=a.helpers,p=n.dom,m=n.utils,s=n.client,t=m.log,c=m.isArray,l=
m.trim,e=m.callback;f.prototype=f.fn={load:function(a,f){var k=this,m=(new Date).getTime(),n=function(){var a=0,b=0,c=null;return{init:function(d,e){c=e;a=d;b=0},loaded:function(){b+=1;b===a&&c()}}}(),r=function(a,c,d){var e=a.url,k=function(){a.loaded(a);n.loaded()},g=a.node||null;d=!!d;switch(a.type){case "js":p.appendJs(e,c,k,g,d);break;case "css":p.appendCss(e,c,k,g,d);break;case "img":p.appendImg(e,c,k,g,d);break;case "html":p.appendHtml(e,c,k,g,d);break;default:b("Didn't match any type for dom append: type "+
a.type),k()}},q=function(a){var c=a.data||null,d=function(a,b){a&&a.data?r(a,a.data,b):r(a,null,b)},g=k.storage,f=g.resources.defaults;a.ajax=a.ajax!==u?!!a.ajax:f.ajax;a.loaded=a.loaded!==u?e(a.loaded):e(f.loaded);g.read(a,function(e){if(e&&e.data){var f=a,h=k.storage.resources.defaults,l=parseInt(e.lifetime,10),n=e.version,p=e.lastmod?e.lastmod:0,q=!1,t,v=f.lastmod?f.lastmod:0,q=!0;t=!1;f.version=t=f.version!==u?parseFloat(f.version):h.version;f.group=f.group!==u?parseFloat(f.group):h.group;v&&
p?(f.lastmod=parseInt(v,10),q=p===f.lastmod):!v&&p?v=p:v||(v=h.lastmod);q=q&&t===n;t=0!==l&&(-1!==l&&q&&e.expires>m||-1===l&&q);f.lastmod=v;f.isValid=t;a=f;a.isValid||!s.isOnline()?(b("Resource is up to date: type "+a.type+", url "+a.url),(c=e.data)&&r(a,c)):(b("Resource is outdated and needs update: type "+a.type+", url "+a.url),g.update(a,d))}else b("Resource or resource data is not available in storage adapter, try to create it: type "+a.type+", url "+a.url),g.create(a,d)})},t=function(a,b){var c=
0,d=a.length,e=null;n.init(d,b);for(c=0;c<d;c+=1)(e=a[c])&&e.url&&(e.url=l(e.url),e.type=g(e),q(e))},B=function(a,b,c){var d=a.length;for(c||(c=0);!a[c]&&c<d;)c+=1;c>=d?b(k):(d=a[c],t(d,function(){B(a,b,c+1)}))};(function(a,d){var k;a&&c(a)||(a=[]);k=a.length;for(var g=a,l=[],m,r=0,n,p=g.length,r=0;r<p;r+=1)n=g[r],(m=n.group)||(m=0),m=l[m]?l[m]:l[m]=[],m.push(n);a=l;d=e(f);b("Load resource function called: "+k+" resources, "+a.length+" groups");B(a,d)})(a,f)},remove:function(a,f){var k=this.storage,
m=function(a,c){var d=a.length,e,f,h=function(a,e){b("Successfully removed resource: url "+e);a===d-1&&c()};if(d)for(e=0;e<d;e+=1)(f=a[e])&&f.url&&(f.url=l(f.url),f.type=g(f),k.remove(f,h(e,f.url)));else c()};(function(a,d){a&&c(a)||(a=[]);d=e(f);b("Remove resource function called: resources count "+a.length);m(a,d)})(a,f)},init:function(c,f){var k=this;c=e(c);b("Cache initializing and checking for storage adapters");a.cache.storage.controller(function(a){k.storage=a;c(a)},f);return k}};a.ns(q+".controller",
f)})(window.getNs());
(function(a,u,b){function g(a){s("[cache interface] "+a)}function f(a){this.storage=this.controller=null;this.params=a;this.queue=new m;this.timeout=this.interval=this.calls=0}function q(a){var b=null,d=p.length,e;a||(a=h);for(e=0;e<d;e+=1)c(p[e].params)===c(a)&&(b=p[e]);b||(b=new f(a),p.push(b));return b}function n(b,c,f){var h=q(b),l,m,n=function(){l=h.interval;a.clearInterval(l);l=a.setInterval(function(){h.timeout=m=h.timeout+e;h.controller&&h.storage&&(a.clearInterval(l),h.queue.flush());m>d&&
(a.clearInterval(l),g("Timeout reached while waiting for cache controller!!!"),f())},e)};h?h.storage?c(h):(h.queue.add(function(){c(h)}),h.calls+=1,1===h.calls?h.controller=new u.cache.controller(function(a){h.storage=a;h.controller?h.queue.flush():n()},b):n()):(g("Whether finding nor initializing a cache interface is possible!!!"),f())}var p=[];b=u.helpers;var m=b.queue;b=b.utils;var s=b.log,t=b.isArray,c=b.jsonToString,l=b.callback,e=25,d=5E3,h={};b=function(){return{load:function(a,b,c){b=l(b);
n(c,function(d){t(a)?d.controller.load(a,b):"applicationCache"===a?(d=d.storage)&&d.appCacheAdapter?d.appCacheAdapter.open(b,c):b(!1):b(!1)},function(){g("Get interface failed!");b(!1)});return this},remove:function(a,b,c){b=l(b);n(c,function(c){t(a)?c.controller.remove(a,b):b(!1)},function(){g("Get interface failed!");b(!1)});return this},setup:function(a){a&&(h=a);return this}}}();u.ns("cache.load",b.load);u.ns("cache.remove",b.remove);u.ns("cache.setup",b.setup)})(window,window.getNs());
