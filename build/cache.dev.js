(function(a,v){function b(){a[k]||(a[k]={});return a[k]}var k="app",d;d=b();d.namespace=d.ns=function(d,b){if(d){d=String(d);var q=d.split("."),p=q.length,t=a[k],s;t||(a[k]={});if(!q)return!1;for(s=0;s<p;s+=1)t[q[s]]||(t[q[s]]={}),s===p-1&&b!==v&&(t[q[s]]=b),t=t[q[s]];return t}return!1};a[k]=d;a.getNamespace=a.getNs=b})(window);
(function(a,v){function b(){if(!(this instanceof b))return new b;this.methods=[];this.response=null;this.flushed=!1}b.prototype=b.fn={add:function(a){this.flushed?a(this.response):this.methods.push(a)},flush:function(a){if(!this.flushed)for(this.response=a,this.flushed=!0;this.methods[0];)this.methods.shift()(a)}};a.ns("helpers.queue",b)})(window.getNs());
(function(a,v,b,k){var d=function(){var b=null,n=[];return{isString:function(a){return"string"===typeof a||a instanceof String},isFunction:function(a){return"function"===typeof a||a instanceof Function},isArray:function(a){var b=Array.isArray,k=Object.prototype.toString;d.isArray=b&&"function"===typeof b?function(a){return b(a)}:k&&"function"===k?function(a){return"[object Array]"===k.call(a)}:function(a){return!!a.sort&&"function"===typeof a.sort};return d.isArray(a)},inArray:function(a,b,k){d.inArray=
Array.prototype.indexOf?function(a,f,m){return n.indexOf.call(f,a,m)}:function(a,f,m){var e=f.length,c=0;if(m)return f[m]&&f[m]===a?m:-1;for(c=0;c<e;c+=1)if(f[c]===a)return c;return-1};return d.inArray(a,b,k)},callback:function(a){d.isFunction(a)||(a=function(){return k});return a},on:function(b,k,t){d.on="function"===typeof a.addEventListener?function(a,f,m){a.addEventListener(f,m,!1)}:"function"===typeof v.attachEvent?function(a,f,m){a.attachEvent("on"+f,m)}:function(a,f,m){a["on"+f]=m};d.on(b,
k,t)},off:function(b,k,t){d.off="function"===typeof a.removeEventListener?function(a,f,m){a.removeEventListener(f,m,!1)}:"function"===typeof v.detachEvent?function(a,f,m){a.detachEvent("on"+f,m)}:function(a,f){a["on"+f]=null};d.off(b,k,t)},getXhr:function(){for(var a=null,b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],k=b.length,d=0,d=0;d<
k;d+=1){try{a=b[d]()}catch(f){continue}break}return a},xhr:function(a,b,t,n){var f=d.getXhr(),m,e="GET";b=d.callback(b);if(f)if(a){n!==k?e="POST":n=null;t===k&&(t=!0);m=function(){if(4===f.readyState&&(200<=f.status&&400>f.status||0===f.status))try{var c=f.responseText;c?b(c):b(!1)}catch(e){b(!1)}else 4===f.readyState&&b(!1)};f.open(e,a,t);try{f.onreadystatechange!==k?f.onreadystatechange=m:f.onload!==k&&(f.onload=m)}catch(c){}f.send(n)}else b(!1);else b(!1)},getJson:function(){null===b&&(a.JSON&&
a.JSON.stringify)&&(b=a.JSON);return b},jsonToString:function(a){var p=!1;null===b&&(b=d.getJson());b&&a!==k&&(p=b.stringify(a));return p},jsonToObject:function(a){var p=!1;null===b&&(b=d.getJson());b&&a!==k&&(p=b.parse(a));return p},logToScreen:function(a){var b=v.getElementById("log"),d=v.createElement("p");a=v.createTextNode(a);b&&(d.appendChild(a),b.appendChild(d))},log:function(){var b=arguments,p=a.console!==k,n=p?a.console:null,p=p&&n.log!==k;b.length&&(p&&n.log.apply(n,b),b=b[0],d.logToScreen(b))},
url:function(a){if(d.isString(a)){var b=v.createElement("a"),k;b.href=a;k=b.pathname.match(/\/([^\/?#]+)$/i);return{source:a,protocol:b.protocol,host:b.hostname,port:b.port,query:b.search,file:k?k[1]:"/",hash:b.hash,path:b.pathname.replace(/^([^\/])/,"/$1"),extension:function(a){a=a.split(".");return a.length?a[a.length-1]:!1}(a),folder:function(){var b=a.lastIndexOf("/");return a.substr(0,b+1)}()}}},trim:function(a){if(!d.isString(a))return a;d.isFunction(String.prototype.trim)||(String.prototype.trim=
function(){return this.replace(/^\s+|\s+$/g,"")});return a.trim()}}}();b.ns("helpers.utils",d)})(window,document,window.getNs());
(function(a,v,b,k){var d=function(){function d(){p===k&&(f(a,"online",d),f(a,"offline",d));p=v.onLine!==k?!!v.onLine:!0}var n,q,p,t,s=(v.userAgent||v.vendor||a.opera).toLowerCase(),f=b.helpers.utils.on;return{isMsie:function(){q===k&&(q=null!==s.match(/(msie)/));return q},isOpera:function(){n===k&&(n=null!==s.match(/(opera)/));return n},isOnline:function(){p===k&&d();return p},hasCanvas:function(){if(t===k){var a=document.createElement("canvas");t=!(!a.getContext||!a.getContext("2d"))}return t}}}();
b.ns("helpers.client",d)})(window,window.navigator,window.getNs());
(function(a,v,b){function k(b,d){d&&(d.dom?b=d.dom:d.id&&(b=a.getElementById(d.id)));return b}var d=function(){var r=v.helpers,n=r.utils,q=r.client,p=[],t=[],s=[],f=[],m=a.getElementsByTagName("head")[0];return{nuke:function(){p=[];t=[];s=[];f=[]},createDomNode:function(e,c){var g=a.createElement(e),l;if(c)for(l in c)c.hasOwnProperty(l)&&g.setAttribute(l,c[l]);return g},getAttribute:function(a,c){return a.getAttribute(c)},setAttribute:function(a,c,g){a.setAttribute(c,g)},appendCss:function(e,c,g,
l,b){if(-1===n.inArray(e,p)||b){var h=null,f=!1,u,t,h=k(h,l);if(null!==c){h||(h=d.createDomNode("style",{type:"text/css"}),h.className="lazyloaded");h.onerror=function(){g(!1)};l||m.appendChild(h);try{u=a.createTextNode(c),h.appendChild(u)}catch(r){h.styleSheet.cssText=c}finally{g(!0)}}else null!==e&&(h||(h=d.createDomNode("link",{rel:"stylesheet",type:"text/css"}),h.className="lazyloaded"),h.onerror=h.error=function(){h.onload=h.load=null;f=!0;window.clearTimeout(t);g(!1)},l||m.appendChild(h),q.isMsie()||
q.isOpera()?h.onload=h.load=function(){h.onerror=h.error=null;f=!0;window.clearTimeout(t);g(!0)}:g(!0),h.href=e,t=window.setTimeout(function(){f||g(!1)},4E3));p.push(e)}else g(!0)},appendJs:function(e,c,g,l,b){if(-1===n.inArray(e,t)||b){b=d.createDomNode("script");var h=a.getElementsByTagName("script")[0],f=!1,u=!1,p;(b=k(b,l))?(b.type="text/javascript",b.className="lazyloaded",b.async=!0,b.onreadystatechange=b.onload=function(){u||this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||
(this.onreadystatechange=this.onload=null,f=u=!0,window.clearTimeout(p),t.push(e),g(!0))},b.onerror=function(){this.onload=this.onreadystatechange=this.onerror=null;window.clearTimeout(p);f=!0;g(!1)},l||(h?h.parentNode.insertBefore(b,h):m.appendChild(b)),c&&!u?(b.textContent?b.textContent=c:b.nodeValue?b.nodeValue=c:b.text=c,f=u=!0):null!==e&&(b.src=e),u&&(t.push(e),f=!0,g(!0)),f||(p=window.setTimeout(function(){u||g(!1)},5E3))):g(!1)}else g(!0)},appendImg:function(a,c,g,l){var f=null;(f=k(f,l))||
(f=new Image);f.onerror=function(){f.onload=f.onerror=null;g(!1)};f.onload=function(){f.onload=f.onerror=null;g(!0)};c?f.src=c:a&&(f.src=a);if(f.complete&&f.naturalWidth!==b)f.onload();s.push(a)},appendHtml:function(e,c,b,l){var d=k(null,l);if(d){if(c)try{d.innerHTML=c,l.id&&q.isMsie()&&a.styleSheets[0].addRule("#"+l.id+":after",'content: " ";')}catch(h){d.innerText=c}b(!0);f.push(e)}else b(!1)}}}();v.ns("helpers.dom",d)})(document,window.getNs());
(function(a,v){function b(a){s("["+q+" Adapter] "+a)}function k(a){if(a){var c=a.name||a.code,g=a.message||a.description||"",l=g;if(FileError)switch(c){case FileError.ENCODING_ERR:case "EncodingError":l="Error Event: ENCODING_ERR "+g;break;case FileError.INVALID_MODIFICATION_ERR:case "InvalidModificationError":l="Error Event: INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:case "InvalidStateError":l="Error Event: INVALID_STATE_ERR "+g;break;case FileError.NO_MODIFICATION_ALLOWED_ERR:case "NoModificationAllowedError":l=
"Error Event: NO_MODIFICATION_ALLOWED_ERR "+g;break;case FileError.NOT_FOUND_ERR:case "NotFoundError":l="Error Event: NOT_FOUND_ERR "+g;break;case FileError.NOT_READABLE_ERR:case "NotReadableError":l="Error Event: NOT_READABLE_ERR "+g;break;case FileError.PATH_EXISTS_ERR:case "PathExistsError":l="Error Event: PATH_EXISTS_ERR "+g;break;case FileError.QUOTA_EXCEEDED_ERR:case "QuotaExceededError":l="Error Event: QUOTA_EXCEEDED_ERR "+g;break;case FileError.SECURITY_ERR:case "SecurityError":l="Error Event: SECURITY_ERR "+
g;break;case FileError.TYPE_MISMATCH_ERR:case "TypeMismatchError":l="Error Event: TYPE_MISMATCH_ERR "+g;break;default:l="Error Event: Unknown Error "+g}else l="Error Event: Unknown Error, no FileError available";b(l,a)}}function d(a,c,b){var l=function(a){k(a);b(!1)};if("."===c[0]||""===c[0])c=c.slice(1);c[0]?a.getDirectory(c[0],{create:!0},function(a){c.length?d(a,c.slice(1),b):b(!0)},l):b(!0)}function r(a,c,b){c=c.split("/");var l=c.length,m="",h=0;b=f(b);if(l){for(h=0;h<l-1;h+=1)m=m+c[h]+"/";d(a.root,
m.split("/"),b)}else b(!0)}function n(a){if(!(this instanceof n))return new n(a);this.adapter=null;this.type=q;this.size=52428800;this.init(a)}var q="fileSystem",p=a.getNs&&a.getNs()||a,t=p.helpers.utils,s=t.log,f=t.callback,m=null;n.prototype=n.fn={isSupported:function(){null===m&&((m=(!!a.requestFileSystem||!!a.webkitRequestFileSystem||!!a.moz_requestFileSystem)&&(!!a.Blob||!!a.BlobBuilder)&&a.FileReader)||b(q+" is not supported"));return m},open:function(e){var c=this,g=c.adapter,l=function(a){k(a);
e(!1)};e=f(e);m?null===g?(a.requestFileSystem=a.requestFileSystem||a.webkitRequestFileSystem||a.moz_requestFileSystem,a.requestFileSystem(a.TEMPORARY,c.size,function(a){g=c.adapter=a;b("Try to create test resource");try{c.create("test-item",t.jsonToString({test:"test-content"}),function(a){a?c.remove("test-item",function(){b("Test resource created and successfully deleted");e(g)}):l()})}catch(f){l(f)}},l)):(b("Adapter already opened"),e(g)):e(!1)},create:function(a,c,g){g=f(g);if(a&&m){var l=this.adapter,
d=function(a){k(a);g(!1,a)};r(l,a,function(){l.root.getFile(a,{create:!0},function(l){l.createWriter(function(l){var f;l.onwriteend=function(){b("File successfully written: url "+a);g(!0)};l.onerror=d;try{Blob?(f=new Blob([c],{type:"text/plain"}),l.write(f)):BlobBuilder&&(f=new BlobBuilder,f.append(c),l.write(f.getBlob("application/json")))}catch(m){d(m)}},d)},d)})}else g(!1)},read:function(a,c){c=f(c);if(a&&m){var b=this.adapter,l=function(a){k(a);c(!1,a)};r(b,a,function(){b.root.getFile(a,{create:!1},
function(a){a.file(function(a){var b=new FileReader;b.onloadend=function(){c(this.result)};b.onerror=l;b.onabort=l;b.readAsText(a)},l)},l)})}else c(!1)},update:function(a,c,b){this.create(a,c,b)},remove:function(a,c){c=f(c);if(a&&m){var b=this.adapter,l=function(a){k(a);c(!1,a)};r(b,a,function(){b.root.getFile(a,{create:!1},function(a){a.remove(function(){c(!0)},l)},l)})}else c(!1)},init:function(a){return this.isSupported()?(a&&a.size&&(this.size=a.size),this):!1}};t.isFunction(p.ns)?p.ns("cache.storage.adapter."+
q,n):p[q]=n})(window);
(function(a,v){function b(a){p("["+r+" Adapter] "+a)}function k(a){a&&b("Database error: "+(a.message||" No message avaible"))}function d(a){if(!(this instanceof d))return new d(a);this.adapter=null;this.type=r;this.dbName="cache";this.dbVersion="1.0";this.dbTable="offline";this.dbDescription="offline cache";this.dbKey="key";this.init(a)}var r="indexedDatabase",n=a.getNs&&a.getNs()||a,q=n.helpers.utils,p=q.log,t=q.callback,s=null;d.prototype=d.fn={isSupported:function(){null===s&&((s=!!a.indexedDB||
!!a.webkitIndexedDB||!!a.mozIndexedDB||!!a.OIndexedDB||!!a.msIndexedDB)||b(r+" is not supported"));return s},create:function(a,d,e){e=t(e);if(a&&s){var c=this.dbTable,g=this.dbName,l=this.adapter.transaction([c],"readwrite");a=l.objectStore(c).put({key:a,content:d});l.onerror=function(a){b("Failed to init transaction while creating/updating database entry "+g+" "+a);k(a);e(!1,a)};a.onerror=function(a){b("Failed to create/update database entry "+g+" "+a);k(a);e(!1,a)};a.onsuccess=function(){e(!0)}}else e(!1)},
read:function(a,d){d=t(d);if(a&&s){var e=this.dbTable,c=this.dbName,g=this.adapter.transaction([e],"readonly"),e=g.objectStore(e).get(a);g&&e?(g.onerror=function(a){b("Failed to init transaction while reading database "+c+" "+a);k(a);d(!1,a)},e.onerror=function(a){b("Failed to read database entry "+c+" "+a);k(a);d(!1,a)},e.onsuccess=function(a){a.target.result&&a.target.result.content?d(a.target.result.content):d(!1)}):d(!1)}else d(!1)},update:function(a,b,d){this.create(a,b,d)},remove:function(a,
d){d=t(d);if(a&&s){var e=this.dbTable,c=this.dbName,g=this.adapter.transaction([e],"readwrite"),e=g.objectStore(e).put({key:a,content:""});g.onerror=function(a){b("Failed to init transaction while deleting database entry "+c+" "+a);k(a);d(!1,a)};e.onerror=function(a){b("Failed to delete database entry "+c+" "+a);k(a);d(!1,a)};e.onsuccess=function(){d(!0)}}else d(!1)},open:function(d,m){m||(m=!1);d=t(d);var e=this,c=null,g=null,l=null,w=e.dbName,h=e.dbTable,n=function(a){a||d(!1);b("Try to create test resource");
e.create("test-item",'{test: "test-content"}',function(c){c?e.remove("test-item",function(){b("Test resource created and successfully deleted");d(a)}):d(!1)})},u,p,q,y,r;if(null===e.adapter)if(c=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.OIndexedDB||a.msIndexedDB){a.webkitIndexedDB!==v&&(a.IDBTransaction=a.webkitIDBTransaction,a.IDBKeyRange=a.webkitIDBKeyRange);u=function(a){a.createIndex(e.dbKey,e.dbKey,{unique:!0});a.createIndex("content","content",{unique:!1})};p=function(a){var c=g.result,
m,y;e.adapter=c;b("Database request successfully done");e.dbVersion===c.version||!c.setVersion&&"function"!==typeof c.setVersion?(e.adapter=c,n(c)):(l=a.currentTarget.result.setVersion(e.dbVersion),l.onfailure=function(a){b("Failed to open database: "+w+" "+a);k(a);d(!1)},l.onsuccess=function(a){m=g.result;try{y=m.createObjectStore(h,{keyPath:e.dbKey}),b("Database needs upgrade: "+w+" "+a.oldVersion+" "+a.newVersion),u(y)}catch(c){b("Failed to open database: "+w+" "+c),k(c),d(!1)}})};q=function(a){var c=
g.result.createObjectStore(h,{keyPath:e.dbKey});b("Database needs upgrade: "+w+" "+a.oldVersion+" "+a.newVersion);u(c)};y=function(a){b("Failed to open database: "+w+" "+a);k(a);m||e.open(d,!0);d(!1)};r=function(a){b("Opening database request is blocked! "+w+" "+a);k(a);d(!1)};if(m)try{g=c.open(w,e.dbVersion)}catch(s){b("Could not set version"),k(s),g=c.open(w)}else g=c.open(w);g.onsuccess=p;g.onupgradeneeded=q;g.onerror=y;g.onblocked=r}else d(!1);else n(e.adapter)},init:function(a){return this.isSupported()?
(a&&(a.name&&(this.dbName=String(a.name)),a.version&&(this.dbVersion=parseInt(a.version,10)),a.table&&(this.dbTable=a.table),a.description&&(this.dbDescription=String(a.description)),a.key&&(this.dbKey=a.key)),this):!1}};q.isFunction(n.ns)?n.ns("cache.storage.adapter."+r,d):n[r]=d})(window);
(function(a,v){function b(a){t("["+n+" Adapter] "+a)}function k(a,b,c,d,l,k){!k&&a?a.transaction(function(a){a.executeSql(b,c,d,l)}):k?k.executeSql(b,c,d,l):l(null,{code:0,message:n+" isn't available"})}function d(a){var d="Errorcode: "+(a.code||"Code not present")+", Message: "+(a.message||"Message not present");a.info&&(d=d+" - "+a.info);b(d)}function r(a){if(!(this instanceof r))return new r(a);this.adapter=null;this.type=n;this.dbName="cache";this.dbVersion="1.0";this.dbDescription="resource cache";
this.dbTable="websql";this.dbSize=4194304;this.init(a)}var n="webSqlDatabase",q=a.getNs&&a.getNs()||a,p=q.helpers.utils,t=p.log,s=p.callback,f=null;r.prototype=r.fn={isSupported:function(){null===f&&((f=!!a.openDatabase)||b(n+" is not supported"));return f},create:function(a,b,c){c=s(c);a&&f?k(this.adapter,"INSERT INTO "+this.dbTable+" (key, content) VALUES (?,?);",[a,b],function(){c(!0)},function(a,b){d(b);c(!1,b,{transaction:a})}):c(!1)},read:function(a,b){b=s(b);a&&f?k(this.adapter,"SELECT content FROM "+
this.dbTable+" WHERE key=?;",[a],function(a,d){var l=!1;d&&(d.rows&&1===d.rows.length)&&(l=d.rows.item(0).content);b(l,null,{transaction:a})},function(a,g){d(g);b(!1,g,{transaction:a})}):b(!1)},update:function(a,b,c){c=s(c);a&&f?k(this.adapter,"UPDATE "+this.dbTable+" SET content = ?  WHERE key=?;",[b,a],function(){c(!0)},function(a,b){d(b);c(!1,b,{transaction:a})}):c(!1)},remove:function(a,b){b=s(b);a&&f?k(this.adapter,"DELETE FROM "+this.dbTable+" WHERE key = ?;",[a],function(){b(!0)},function(a,
g){d(g);b(!1,g,{transaction:a})}):b(!1)},open:function(m){m=s(m);if(f){var e=this,c=e.adapter,g,l=function(a){a||m(!1);b("Try to create test resource");g=function(c){c?e.remove("test-item",function(){b("Test resource created and successfully deleted");m(a)}):m(!1)};e.read("test-item",function(a){a?e.update("test-item",'{test: "test-content"}',g):e.create("test-item",'{test: "test-content"}',g)})},w=function(a,c){b("Checking database table: name "+e.dbTable);k(a,"CREATE TABLE IF NOT EXISTS "+e.dbTable+
"(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, key TEXT NOT NULL UNIQUE, content TEXT NOT NULL);",[],function(){l(e.adapter)},function(a){d(a);l(!1)},c)},h=function(a){w(null,a)},n=function(a){a.info="Can't migrate to new database version. This may be caused by non-standard implementation of the changeVersion method. Please switch back your database version to use webSql on this device.";d(a);m(!1)};try{if(null===c&&e.isSupported())if(b("Initializing database"),e.adapter=c=a.openDatabase(e.dbName,
"",e.dbDescription,e.dbSize),String(c.version)!==String(e.dbVersion)&&c.changeVersion&&"function"===typeof c.changeVersion){b("Try to update version: new version "+c.version+", old version "+e.dbVersion);try{c.changeVersion(c.version,e.dbVersion,h,n)}catch(u){d(u),m(!1)}}else b("Open database with version number: "+e.dbVersion),c=a.openDatabase(e.dbName,e.dbVersion,e.dbDescription,e.dbSize),w(c);else e.isSupported()&&(b("database already initialized"),l(c))}catch(p){d(p),m(!1)}}else m(!1)},init:function(a){return this.isSupported()?
(a&&(a.description&&(this.dbDescription=a.description),a.name&&(this.dbName=a.name),a.size&&(this.dbSize=a.size),a.table&&(this.dbTable=a.table),a.version&&(this.dbVersion=String(a.version))),this):!1}};p.isFunction(q.ns)?q.ns("cache.storage.adapter."+n,r):q[n]=r})(window);
(function(a,v){function b(a){s("["+n+" Adapter] "+a)}function k(c){!c&&a.event&&(c=a.event);b("Event - key: "+(c.key||"no e.key event")+", url: "+(c.url||"no e.url event"))}function d(a){a=f(a);switch(a){case "local":a="localStorage";break;case "session":a="sessionStorage";break;default:a="localStorage"}return a}function r(a){if(!(this instanceof r))return new r(a);this.adapter=null;this.type=n;this.lifetime="local";this.asynch=!0;this.init(a)}var n="webStorage",q=a.getNs&&a.getNs()||a,p=q.helpers.utils,
t=p.on,s=p.log,f=p.trim,m=p.callback,e=null;r.prototype=r.fn={isSupported:function(){var c=d(this.lifetime);if(null===e)try{e=!!a[c]&&!!a[c].getItem}catch(g){b(n+" is not supported",g),e=!1}return e},create:function(a,b,d){var e=this,h=!0,f=function(a){if(e.asynch)d(a);else return a};d=m(d);if(!a)return f(!1);try{e.adapter.setItem(a,b)}catch(u){h=!h,k(u)}return f(h)},read:function(a,b){var d=this,e,h=!0,f=function(a){if(d.asynch)b(a);else return a};b=m(b);if(!a)return f(!1);try{h=(e=d.adapter.getItem(a))?
e:!1}catch(u){h=!h,k(u)}return f(h)},update:function(a,b,d){if(this.asynch)this.create(a,b,d);else return this.create(a,b,d)},remove:function(a,b){var d=this,e=!0,h=function(a){if(d.asynch)b(a);else return a};b=m(b);if(!a)return h(!1);try{d.adapter.removeItem(a)}catch(f){e=!e,k(f)}return h(e)},open:function(c){var e=this,l=e.adapter,f=d(e.lifetime),h,n,u=function(a){if(e.asynch)c(a);else return a};c=m(c);if(null===l)try{if(l=e.adapter=a[f],t(a,"storage",k),b("Lifetime used: "+f),b("Try to create test resource"),
e.asynch)e.create("test-item",'{test: "test-content"}',function(a){a?e.remove("test-item",function(){b("Test resource created and successfully deleted");c(l)}):c(!1)});else{if(h=e.create("test-item",'{test: "test-content"}'))if(n=e.remove("test-item"))return b("Test resource created and successfully deleted"),l;return!1}}catch(p){return k(p),u(!1)}else if(e.isSupported())return u(l)},init:function(a){return this.isSupported()?(a&&(a.lifetime&&(this.lifetime=f(String(a.lifetime))),a.asynch!==v&&(this.asynch=
!!a.asynch)),this):!1}};p.isFunction(q.ns)?q.ns("cache.storage.adapter."+n,r):q[n]=r})(window);
(function(a,v,b){function k(a){m("["+n+" Adapter] "+a)}function d(b,d){d.isLoaded||(d.isLoaded=!0,d.progressCallback(100),a.setTimeout(function(){b();k("Event loaded")},d.delay))}function r(a){if(!(this instanceof r))return new r(a);this.adapter=null;this.type=n;this.isLoaded=!1;this.delay=0;this.opened=!0;this.message="New version is available. Update page?";this.init(a)}var n="applicationCache",q=a.getNs&&a.getNs()||a,p=q.helpers,t=p.utils,s=p.dom,f=t.on,m=t.log,e=t.callback,c=null,g=v.getElementsByTagName("html")[0];
r.prototype=r.fn={isSupported:function(){null===c&&((c=!!a.applicationCache&&!!s.getAttribute(g,"manifest"))||k(n+" is not supported or there is no manifest html attribute"));return c},open:function(c,g){var h=this,m=h.adapter,u=0,n,p;h.opened=!0;c=e(c);g&&g.progress&&(n=g.progress);n=h.progressCallback=e(n);if(h.isSupported()&&null!==m){p=function(){k("Event updateready");try{m.swapCache()}catch(b){k("Event updateready: swapcache is not available",b)}confirm(h.message)?a.location.reload(!0):d(c,
h);return!1};f(m,"checking",function(){k("Event checking");return!1});f(m,"noupdate",function(){k("Event noupdate");d(c,h);return!1});f(m,"downloading",function(){k("Event downloading");u=0;return!1});f(m,"progress",function(a){k("Event progress");var d=0;h.delay=500;u+=1;d=a&&a.lengthComputable!==b?Math.round(100*a.loaded/a.total):Math.round(100*u/20);n(d);return!1});f(m,"cached",function(){k("Event cached");d(c,h);return!1});f(m,"updateready",function(){p()});f(m,"obsolete",function(){k("Event obsolete");
a.location.reload(!0);return!1});f(m,"error",function(){k("Event error");d(c,h);return!1});switch(m.status){case m.UNCACHED:d(c,h);break;case m.IDLE:d(c,h);break;case m.UPDATEREADY:p();break;case m.OBSOLETE:d(c,h)}f(a,"online",function(){try{m.update()}catch(a){k("Window event online: update cache is not available",a)}});a.setTimeout(function(){h.isLoaded||d(c,h)},12E3)}else d(c,h)},init:function(b){var d=this.adapter;this.isSupported()&&(null===d&&(this.adapter=a.applicationCache),b&&b.message&&
(this.message=String(b.message)));return this}};q.ns("cache.storage.adapter."+n,r)})(window,document);
(function(a,v,b,k){function d(a){u("["+g+" controller] "+a)}function r(a){var b="";a&&(b="Error Event: Description "+(a.description||"no description available"));d(b)}function n(b,d,c){c.timeout=a.setTimeout(function(){d(!1)},4E3);y(b,function(b){a.clearTimeout(c.timeout);delete c.timeout;b?d(b):d(!1)})}function q(a){var b=null;try{b=h.jsonToObject(a)}catch(c){r(c),d("Couldn't convert json string to object.")}return b}function p(a,b,d){if(G){var c=v.createElement("canvas"),e,f=new Image,h=null,g=
0,l=0;d||(d="jpeg");f.onerror=function(){f.onload=f.onerror=null;b()};f.onload=function(){f.onload=f.onerror=null;g=c.height=f.height;l=c.width=f.width;e=c.getContext("2d");e.fillStyle="rgba(50, 50, 50, 0)";e.fillRect(0,0,l,g);e.drawImage(f,0,0);h=c.toDataURL("image/"+d);b(h)};f.src=a;if(f.complete&&f.naturalWidth!==k)f.onload()}else b(!1)}function t(a){var b=a.data,d=a.url;"css"===a.type&&(d=h.url(d),d=d.folder,b=b.replace(/url\(\../g,"url("+d+".."),b=b.replace(/url\(\'../g,"url('"+d+".."),b=b.replace(/url\(\"../g,
'url("'+d+".."),a.data=b);return a}function s(a,b){return{ajax:a.ajax,data:a.data,expires:(new Date).getTime()+(a.lifetime||b.lifetime),group:a.group!==k?a.group:b.group,lastmod:a.lastmod||b.lastmod,lifetime:a.lifetime!==k?a.lifetime:b.lifetime,type:a.type||b.type,version:a.version||b.version}}function f(a){return A&&A[a]?!!A[a]:!1}function m(a,b){var c=null,e,f;a&&a.length?(e=a[0].type,f=a.slice(1),d("Testing for storage adapter type: "+e),B[e]?c=new B[e](D):m(f,b),c&&c.isSupported()?c.open(function(h){h?
(C=e,A=a[0],d("Used storage adapter type: "+C),b(c)):m(f,b)}):m(f,b)):b(!1)}function e(a,b,c){var f=null,h=0,k;if(c)try{d("Testing for preferred storage adapter type: "+c),B[c]?(f=new B[c](D))&&f.isSupported()?f.open(function(g){if(g){C=c;k=b.length;for(h=0;h<k;h+=1)b[h].type===c&&(A=b[h]);A?(d("Used storage type: "+C),a(f)):(d("Storage config not found: "+C),e(a,b))}else e(a,b)}):e(a,b):e(a,b)}catch(g){r(g),d("Storage adapter could not be initialized: type "+c),e(a,b)}else m(b,a)}function c(a,b){if(!(this instanceof
c))return new c(a,b);this.isEnabled=!0;this.appCacheAdapter=this.adapter=null;this.adapters={types:H,defaults:D};this.resources={defaults:I};this.init(a,b)}var g="storage",l=b.helpers,w=l.client,h=l.utils,F=h.isArray,u=h.log,z=h.callback,E=h.getJson(),y=h.xhr,x=h.trim,B=b.cache.storage.adapter,G=w.hasCanvas(),H=[{type:"fileSystem",css:!0,js:!0,html:!0,img:!0},{type:"indexedDatabase",css:!0,js:!0,html:!0,img:!0},{type:"webSqlDatabase",css:!0,js:!0,html:!0,img:!0},{type:"webStorage",css:!0,js:!0,html:!0,
img:!0}],D={name:"localcache",table:"cache",description:"local resource cache",size:4194304,version:"1.0",key:"key",lifetime:"local",offline:!0},C=null,A=null,I={ajax:!0,lifetime:2E4,group:0,lastmod:(new Date).getTime(),type:"css",version:1};c.prototype=c.fn={create:function(a,b){b=z(b);if(a&&a.url){var c=this,e=a.url,k=a.type,g=function(g){if(g)if(a.data=g,a=t(a),null!==c.adapter&&f(k)){g=h.jsonToString(e);var l=s(a,c.resources.defaults),m=h.jsonToString(l);a.expires=l.expires;a.version=l.version;
try{c.adapter.create(g,m,function(c){c?(d("Create new resource in storage adapter: type "+k+", url "+e),b(a)):(d("Create new resource in storage adapter failed"),b(!1))})}catch(n){r(n),d("Create new resource in storage adapter failed"),b(a)}}else d("Trying to create new resource, but resource type is not cachable or storage adapter is not available: type "+k+", url "+e),b(a);else d("Couldn't get data via network"),b(a)};a.ajax?"img"===k?p(e,g):n(e,g,a):a.data?g(a.data):b(!1)}else b(!1)},read:function(a,
b){b=z(b);if(a&&a.url){var c=this,e=a.url,g=a.type;if(null!==this.adapter&&f(g)){d("Trying to read resource from storage: type "+g+", url "+e);try{c.adapter.read(h.jsonToString(e),function(f){f?(a=q(f))?(a.url=e,d("Successfully read resource from storage: type "+g+", url "+e),b(a,!0)):c.remove({url:e,type:g},function(){b(!1)}):(d("There is no data coming back from storage while reading: type "+g+", url "+e),b(!1))})}catch(k){r(k),d("Try to read resource from storage, but storage adapter is not available: type "+
g+", url "+e),n(e,function(c){d("Data loaded via ajax: type "+g+", url "+e+", data status "+!!c);a.data=c;b(a,!0)},a)}}else b(a)}else b(!1)},update:function(a,b){b=z(b);if(a&&a.url){var c=this,e=a.url,g=a.type,k=function(k){if(k)if(a.data=k,a=t(a),null!==c.adapter&&f(g)){k=h.jsonToString(e);var l=s(a,c.resources.defaults),m=h.jsonToString(l);a.expires=l.expires;a.version=l.version;try{c.adapter.update(k,m,function(c){c?(d("Updated existing resource in storage adapter: type "+g+", url "+e),b(a)):(d("Updating resource in storage failed."),
b(!1))})}catch(n){r(n),d("Updating resource in storage failed."),b(a)}}else d("Resource type is not cachable or storage adapter is not available: type "+g+", url "+e),b(a);else d("Couldn't get data via network, trying to used stored version"),c.read(a,function(c){c&&c.data?(a.data=c.data,b(a)):b(!1)})};a.ajax?"img"===g?p(e,k):n(e,k,a):a.data?k(a.data):b(!1)}else b(!1)},remove:function(a,b){b=z(b);if(a&&a.url){var c=a.url,e=a.type;null!==this.adapter&&f(e)?this.adapter.remove(h.jsonToString(c),function(f){f?
(d("Delete resource form storage: type "+e+", url "+c),b(a)):(d("Deleting resource form storage failed: type "+e+", url "+c),b(!1))}):(d("Delete resource from storage failed, resource type is not cachable or there is no storage adapter: type "+e+", url "+c),b(a))}else b(!1)},init:function(a,b){var c=this,f=!1,g,h,l,m;a=z(a);b&&b.isEnabled!==k&&(c.isEnabled=!!b.isEnabled);if(c.isEnabled&&E){if(b){if(b.adapters){g=b.adapters;if(g.types&&F(g.types)){h=g.types;l=h.length;for(m=0;m<l;m+=1)h[m].css===k&&
(h[m].css=!0),h[m].js===k&&(h[m].js=!0),h[m].img===k&&(h[m].img=!0),h[m].html===k&&(h[m].html=!0);c.adapters.types=h}g.defaults&&(h=g.defaults,l=c.adapters.defaults,h.name&&(l.name=x(String(h.name))),h.table&&(l.table=x(String(h.table))),h.description&&(l.description=x(String(h.description))),h.size&&(l.size=parseInt(h.size,10)),h.version&&(l.version=x(String(h.version))),h.key&&(l.key=x(String(h.key))),h.lifetime&&(l.lifetime=x(String(h.lifetime))),h.offline!==k&&(l.offline=!!h.offline));g.preferredType&&
(f=x(String(g.preferredType)))}b.resources&&(g=b.resources,g.defaults&&(g=g.defaults,h=c.resources.defaults,g.ajax!==k&&(h.ajax=!!g.ajax),g.lifetime!==k&&(h.lifetime=parseInt(g.lifetime,10)),g.group!==k&&(h.group=parseInt(g.group,10)),g.lastmod!==k&&(h.lastmod=parseInt(g.lastmod,10)),g.type&&(h.type=x(String(g.type))),g.group!==k&&(h.version=parseFloat(g.version)),g.loaded&&(h.loaded=z(g.loaded))))}e(function(b){c.adapter=b;a(c)},c.adapters.types,f);c.adapters.defaults.offline&&(B.applicationCache&&
!c.appCacheAdapter)&&(c.appCacheAdapter=new B.applicationCache(D))}else E||d("There is no json support"),c.isEnabled||d("Caching data is disabled"),a(c)}};b.ns("cache."+g+".controller",c)})(window,document,window.getNs());
(function(a,v){function b(a){s("["+r+" controller] "+a)}function k(a){var b=m(a.type);if("js"!==b||"css"!==b||"html"!==b||"img"!==b||"custom"!==b){switch(p.url(a.url).extension){case "js":a="js";break;case "css":a="css";break;case "html":a="html";break;case "jpg":case "jpeg":case "png":a="img";break;default:a="custom"}b=a}return b}function d(a,b){if(!(this instanceof d))return new d(a,b);this.storage=null;this.init(a,b)}var r="cache",n=a.helpers,q=n.dom,p=n.utils,t=n.client,s=p.log,f=p.isArray,m=
p.trim,e=p.callback;d.prototype=d.fn={load:function(a,d){var l=this,n=(new Date).getTime(),h=function(){var a=0,b=0,c=null;return{init:function(d,e){c=e;a=d;b=0},loaded:function(){b+=1;b===a&&c()}}}(),p=function(a,c,d){var e=a.url,f=function(){a.loaded(a);h.loaded()},g=a.node||null;d=!!d;switch(a.type){case "js":q.appendJs(e,c,f,g,d);break;case "css":q.appendCss(e,c,f,g,d);break;case "img":q.appendImg(e,c,f,g,d);break;case "html":q.appendHtml(e,c,f,g,d);break;default:b("Didn't match any type for dom append: type "+
a.type),f()}},u=function(a){var c=a.data||null,d=function(a,b){a&&a.data?p(a,a.data,b):p(a,null,b)},h=l.storage,f=h.resources.defaults;a.ajax=a.ajax!==v?!!a.ajax:f.ajax;a.loaded=a.loaded!==v?e(a.loaded):e(f.loaded);h.read(a,function(e){if(e&&e.data){var f=a,g=l.storage.resources.defaults,k=parseInt(e.lifetime,10),m=e.version,u=e.lastmod?e.lastmod:0,q=!1,r,s=f.lastmod?f.lastmod:0,q=!0;r=!1;f.version=r=f.version!==v?parseFloat(f.version):g.version;f.group=f.group!==v?parseFloat(f.group):g.group;s&&
u?(f.lastmod=parseInt(s,10),q=u===f.lastmod):!s&&u?s=u:s||(s=g.lastmod);q=q&&r===m;r=0!==k&&(-1!==k&&q&&e.expires>n||-1===k&&q);f.lastmod=s;f.isValid=r;a=f;a.isValid||!t.isOnline()?(b("Resource is up to date: type "+a.type+", url "+a.url),(c=e.data)&&p(a,c)):(b("Resource is outdated and needs update: type "+a.type+", url "+a.url),h.update(a,d))}else b("Resource or resource data is not available in storage adapter, try to create it: type "+a.type+", url "+a.url),h.create(a,d)})},r=function(a,b){var c=
0,d=a.length,e=null;h.init(d,b);for(c=0;c<d;c+=1)(e=a[c])&&e.url&&(e.url=m(e.url),e.type=k(e),u(e))},s=function(a,b,c){var d=a.length;for(c||(c=0);!a[c]&&c<d;)c+=1;c>=d?b(l):(d=a[c],r(d,function(){s(a,b,c+1)}))};(function(a,c){var h;a&&f(a)||(a=[]);h=a.length;for(var k=a,l=[],m,n=0,u,p=k.length,n=0;n<p;n+=1)u=k[n],(m=u.group)||(m=0),m=l[m]?l[m]:l[m]=[],m.push(u);a=l;c=e(d);b("Load resource function called: "+h+" resources, "+a.length+" groups");s(a,c)})(a,d)},remove:function(a,d){var l=this.storage,
n=function(a,c){var d=a.length,e,f,g=function(a,e){b("Successfully removed resource: url "+e);a===d-1&&c()};if(d)for(e=0;e<d;e+=1)(f=a[e])&&f.url&&(f.url=m(f.url),f.type=k(f),l.remove(f,g(e,f.url)));else c()};(function(a,c){a&&f(a)||(a=[]);c=e(d);b("Remove resource function called: resources count "+a.length);n(a,c)})(a,d)},init:function(c,d){var f=this;c=e(c);b("Cache initializing and checking for storage adapters");a.cache.storage.controller(function(a){f.storage=a;c(a)},d);return f}};a.ns(r+".controller",
d)})(window.getNs());
(function(a,v,b){function k(a){t("[cache interface] "+a)}function d(a){this.storage=this.controller=null;this.params=a;this.queue=new p;this.timeout=this.interval=this.calls=0}function r(a){var b=null,c=q.length,e;a||(a=l);if(f)for(e=0;e<c;e+=1)m(q[e].params)===m(a)&&(b=q[e]);b||(b=new d(a),q.push(b));return b}function n(b,d,e){var f=r(b),l,m,n=function(){l=f.interval;a.clearInterval(l);l=a.setInterval(function(){f.timeout=m=f.timeout+c;f.controller&&f.storage&&(a.clearInterval(l),f.queue.flush());
m>g&&(a.clearInterval(l),k("Timeout reached while waiting for cache controller!!!"),e())},c)};f?f.storage?d(f):(f.queue.add(function(){d(f)}),f.calls+=1,1===f.calls?f.controller=new v.cache.controller(function(a){f.storage=a;f.controller?f.queue.flush():n()},b):n()):(k("Whether finding nor initializing a cache interface is possible!!!"),e())}var q=[];b=v.helpers;var p=b.queue;b=b.utils;var t=b.log,s=b.isArray,f=b.getJson(),m=b.jsonToString,e=b.callback,c=25,g=5E3,l={};b=function(){return{load:function(a,
b,c){b=e(b);n(c,function(d){s(a)?d.controller.load(a,b):"applicationCache"===a?(d=d.storage)&&d.appCacheAdapter?d.appCacheAdapter.open(b,c):b(!1):b(!1)},function(){k("Get interface failed!");b(!1)});return this},remove:function(a,b,c){b=e(b);n(c,function(c){s(a)?c.controller.remove(a,b):b(!1)},function(){k("Get interface failed!");b(!1)});return this},setup:function(a){a&&(l=a);return this}}}();v.ns("cache.load",b.load);v.ns("cache.remove",b.remove);v.ns("cache.setup",b.setup)})(window,window.getNs());
